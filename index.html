<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>XPO ‚Äî Registro de Plataformas (Apple FX)</title>

<!-- Forzar siempre light mode -->
<style>
:root { color-scheme: light; }

/* ===== Minimal Normalize / Reset ===== */
*{box-sizing:border-box}html,body{height:100%}body{margin:0}
h1,h2,h3,h4,p{margin:0}button,input,textarea{font:inherit}
img,svg,video{display:block;max-width:100%}

/* ===== Design Tokens (Apple-like, solo light) ===== */
:root{
  --accent:#0A84FF;
  --bg:#F5F6F7;
  --panel:#FFFFFF;
  --line:#E6E6EA;
  --text:#111418;
  --muted:#6A6F75;
  --ok:#34C759;
  --warn:#FF9F0A;
  --danger:#FF3B30;
  --radius:18px;
  --shadow-1:0 10px 28px rgba(0,0,0,.06);
  --shadow-2:0 4px 18px rgba(0,0,0,.07);
  --ease-snap:cubic-bezier(.22,1,.36,1);
  --ease-soft:cubic-bezier(.25,.8,.25,1);
  --blur:18px;
  --glass:rgba(255,255,255,.68);
}

/* Motion-safe */
@media (prefers-reduced-motion: reduce){
  *{animation-duration:.001ms !important;transition-duration:.001ms !important;scroll-behavior:auto !important}
}

/* ===== Base ===== */
html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility}
body{
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",system-ui,Segoe UI,Roboto,Helvetica,Arial;
  background:radial-gradient(1200px 600px at 10% -10%, rgba(10,132,255,.06), transparent 60%), var(--bg);
  color:var(--text); line-height:1.45;
}
input,textarea,button{font-size:16px}
button{-webkit-tap-highlight-color:transparent}

.app{
  max-width:1040px;margin:0 auto;
  padding:calc(18px + env(safe-area-inset-top)) 16px calc(28px + env(safe-area-inset-bottom)) 16px;
}

/* ===== Header ===== */
.header{
  position:sticky; top:12px; z-index:10;
  border-radius:22px; padding:22px 20px;
  background:var(--glass);
  border:1px solid rgba(120,120,140,.22);
  backdrop-filter:saturate(1.4) blur(var(--blur));
  box-shadow:var(--shadow-1);
  overflow:hidden; isolation:isolate;
}
.header::before{
  content:""; position:absolute; inset:0;
  background:linear-gradient(180deg, rgba(10,132,255,.10), transparent 60%);
}
.brand{display:flex;align-items:center;justify-content:center;gap:10px;font-weight:800;letter-spacing:.12em}
.chip{background:rgba(242,243,244,.8);border:1px solid var(--line);padding:6px 10px;border-radius:10px;font-weight:800}
.headline{text-align:center;font-weight:800;font-size:clamp(20px,3.3vw,28px)}
.subtle{text-align:center;color:var(--muted);font-weight:600;margin-top:6px}

/* ===== Card ===== */
.card{
  background:var(--panel); border:1px solid var(--line);
  border-radius:var(--radius); box-shadow:var(--shadow-2);
  margin:18px 0; overflow:hidden;
  transition:transform .35s var(--ease-soft), box-shadow .35s var(--ease-soft);
}
.card:hover{transform:translateY(-2px); box-shadow:0 10px 32px rgba(0,0,0,.12)}

.card-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 16px;border-bottom:1px solid var(--line);
}
.chevron{opacity:.65}
.title-lg{font-weight:800;letter-spacing:.02em}

/* Screens */
.card-content{position:relative;min-height:260px; perspective:1000px}
.screen{
  position:absolute; inset:0; padding:18px 16px;
  display:flex; flex-direction:column; gap:14px; align-items:center; justify-content:center;
  opacity:0; transform:translateX(24px) scale(.985);
  transition:opacity .44s var(--ease-snap), transform .44s var(--ease-snap);
  pointer-events:none;
  will-change:transform, opacity;
}
.screen.active{opacity:1; transform:none; pointer-events:auto}
.screen.out-left{animation:slideOutL .36s var(--ease-snap)}
.screen.out-right{animation:slideOutR .36s var(--ease-snap)}

@keyframes slideOutL{to{opacity:0;transform:translateX(-24px) scale(.985)}}
@keyframes slideOutR{to{opacity:0;transform:translateX(24px) scale(.985)}}

/* ===== Progress Pills ===== */
.steps{
  display:flex; justify-content:center; gap:6px; padding:16px 0 6px;
}
.step-pill{
  width:42px; height:6px; border-radius:999px;
  background:#D4D7DB; overflow:hidden; position:relative;
}
.step-pill .fill{
  position:absolute; inset:0; width:0%; background:var(--accent);
  transition:width .4s var(--ease-snap);
}
.step-pill.active .fill{ width:100% }

/* Inputs */
.input,.textarea{
  width:100%; max-width:520px; padding:14px 16px;
  border-radius:12px; border:1px solid var(--line); background:#fff;
  transition:border-color .22s, box-shadow .22s, transform .12s;
}
.input:focus,.textarea:focus{
  border-color:var(--accent); box-shadow:0 0 0 8px rgba(10,132,255,.12);
  transform:translateY(-1px);
}
.textarea{min-height:120px; max-height:180px; overflow:auto; resize:vertical}

/* Buttons */
.row{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:12px 18px; border:0; border-radius:12px;
  font-weight:700; color:#fff; background:#1C1C1E;
  transition:transform .14s, filter .18s, box-shadow .2s;
}

.btn-primary{background:var(--accent)}
.btn-secondary{background:#8E8E93}
.btn-danger{background:var(--danger)}
.btn-cargada{background:var(--danger)}
.btn-vacia{background:var(--ok)}
.btn-averiada{background:var(--warn)}
.btn:active{transform:scale(.985)}
.btn:disabled{opacity:.6}

/* Activar magnetismo solo en pointer: fine (desktop) */
@media (pointer:fine){
  .btn:hover{transform:scale(1.02)}
}

/* Panels */
.panel{
  background:var(--panel); border:1px solid var(--line);
  border-radius:var(--radius); padding:18px; box-shadow:var(--shadow-2);
  margin:18px 0;
}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
.stat{
  background:linear-gradient(180deg,#FBFBFC,transparent);
  border:1px solid var(--line);border-radius:12px;padding:16px;text-align:center;
}
.stat .n{font-size:clamp(24px,4vw,32px);font-weight:800;color:var(--accent)}
.stat .label{color:var(--muted);font-weight:600}

.lists{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
.empty{padding:14px;border:1px dashed var(--line);border-radius:12px;color:var(--muted);text-align:center;font-style:italic}

.card-row{
  background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px 14px;margin-bottom:10px;
  transition:transform .18s, box-shadow .18s;
}
.card-row:hover{transform:translateY(-1px);box-shadow:var(--shadow-2)}
.card-row .head span:first-child{
  max-width:70%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
</style>
</head>

<body>
<div class="app">

<!-- ================= HEADER ================= -->
<header class="header" id="glassHeader">
  <div class="brand">
    <div class="chip">CODE</div>
    <div>XPO LOGISTICS</div>
  </div>
  <div class="headline">Registro de Plataformas</div>
  <div class="subtle" id="currentDate"></div>
</header>

<!-- ================= CARD FLOW ================= -->
<section class="card" id="flowCard">
  <div class="card-header">
    <div class="chevron">‚ü®</div>
    <div class="title-lg" id="flowTitle">Matr√≠cula</div>
    <div class="chevron">‚ü©</div>
  </div>

  <div class="card-content" id="screens">

    <!-- Paso 1 -->
    <div class="screen active" id="s1" tabindex="-1">
      <h2 style="font-weight:800;font-size:18px">Paso 1: Matr√≠cula</h2>
      <input id="matriculaInput" class="input" placeholder="Introduce la matr√≠cula" />
      <div class="hint">Pulsa Enter para continuar.</div>
      <button class="btn btn-primary" id="toS2">Continuar</button>
    </div>

    <!-- Paso 2 -->
    <div class="screen" id="s2">
      <h2 style="font-weight:800;font-size:18px">Paso 2: Estado</h2>
      <p class="subtle">Matr√≠cula: <strong id="matriculaDisplay">‚Äî</strong></p>
      <div class="row">
        <button class="btn btn-cargada" id="btnCargada">CARGADA</button>
        <button class="btn btn-vacia" id="btnVacia">VAC√çA</button>
        <button class="btn btn-averiada" id="btnAveriada">üõ† AVERIADA</button>
      </div>
      <div class="row">
        <button class="btn btn-secondary" id="back1">Volver</button>
      </div>
    </div>

    <!-- Paso 3 -->
    <div class="screen" id="s3">
      <h2 style="font-weight:800;font-size:18px">Paso 3: Contenido</h2>
      <p class="subtle">Matr√≠cula: <strong id="matriculaDisplay2">‚Äî</strong> ‚Äî Estado: <strong id="estadoDisplay">‚Äî</strong></p>
      <textarea id="contenidoInput" class="textarea" placeholder="Describe el contenido o problema‚Ä¶"></textarea>
      <div class="row">
        <button class="btn btn-primary" id="btnRegistrar">Registrar</button>
        <button class="btn btn-secondary" id="back2">Volver</button>
      </div>
    </div>

  </div>

  <!-- Progress Pills -->
  <div class="steps">
    <div class="step-pill" id="p1"><div class="fill"></div></div>
    <div class="step-pill" id="p2"><div class="fill"></div></div>
    <div class="step-pill" id="p3"><div class="fill"></div></div>
  </div>
</section>

<!-- ================= SUMMARY ================= -->
<section class="panel">
  <h3 style="text-align:center;margin-bottom:10px">Resumen del d√≠a</h3>
  <div class="stats">
    <div class="stat"><span class="n" id="cargadasCount">0</span><span class="label">Cargadas</span></div>
    <div class="stat"><span class="n" id="vaciasCount">0</span><span class="label">Vac√≠as</span></div>
    <div class="stat"><span class="n" id="averiadasCount">0</span><span class="label">Averiadas</span></div>
    <div class="stat"><span class="n" id="totalCount">0</span><span class="label">Total</span></div>
  </div>
</section>

<!-- ================= LISTAS ================= -->
<section class="panel">
  <div class="lists">
    <div class="list">
      <h3>Cargadas (<span id="cargadasListCount">0</span>)</h3>
      <div id="cargadasList"></div>
    </div>
    <div class="list">
      <h3>Vac√≠as (<span id="vaciasListCount">0</span>)</h3>
      <div id="vaciasList"></div>
    </div>
    <div class="list">
      <h3>Averiadas (<span id="averiadasListCount">0</span>)</h3>
      <div id="averiadasList"></div>
    </div>
  </div>
</section>

<!-- ================= ACTIONS ================= -->
<section class="panel actions" style="display:flex;gap:12px;justify-content:center">
  <button class="btn btn-primary" id="genPdf">üìÑ Generar PDF</button>
  <button class="btn btn-danger" id="clearAll">üóë Limpiar registros</button>
</section>

</div>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* UTILIDADES */
const $ = (id) => document.getElementById(id);
const fmtDateLong = () => new Date().toLocaleDateString('es-ES',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
const fmtHour = () => new Date().toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit',second:'2-digit'});

/* ESTADO */
let plataformas = [];
let currentMatricula = '';
let currentEstado = '';
let step = 1;

const STORAGE_KEY = 'plataformas-global';
function loadData(){ try{ plataformas = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];}catch{ plataformas=[]; } }
function saveData(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(plataformas)); }

/* CAMBIO DE PASOS */
function showStep(next, dir='forward'){
  const cur=$('s'+step), nxt=$('s'+next);
  if(!nxt || cur===nxt) return;

  cur.classList.remove('active');
  cur.classList.add(dir==='forward'?'out-left':'out-right');
  setTimeout(()=>cur.classList.remove('out-left','out-right'),360);
  nxt.classList.add('active');

  // progress pills
  ['p1','p2','p3'].forEach((id,i)=>$(id).classList.toggle('active',next===i+1));

  $('flowTitle').textContent = next===1?'Matr√≠cula':next===2?'Estado':'Contenido';
  step = next;

  requestAnimationFrame(()=>nxt.focus({preventScroll:true}));
}

function nextFromS1(){
  const m=$('matriculaInput').value.trim().toUpperCase();
  if(!m){ alert('Introduce una matr√≠cula v√°lida'); return; }
  currentMatricula=m;
  $('matriculaDisplay').textContent=m;
  $('matriculaDisplay2').textContent=m;
  showStep(2,'forward');
}

function chooseEstado(est){
  currentEstado=est;
  $('estadoDisplay').textContent=est;

  if(est==='VAC√çA'){
    const dup = plataformas.some(p=>p.matricula===currentMatricula);
    if(dup){ alert('Esta matr√≠cula ya existe'); resetFlow(); return; }
    plataformas.push({id:Date.now(), matricula:currentMatricula, estado:est, contenido:'', timestamp:fmtHour()});
    saveData(); updateAll(); resetFlow();
  } else {
    showStep(3,'forward');
  }
}

function registrar(){
  const contenido=$('contenidoInput').value.trim();
  if(!contenido){ alert('Describe el contenido'); return; }

  plataformas.push({id:Date.now(), matricula:currentMatricula, estado:currentEstado, contenido, timestamp:fmtHour()});
  saveData(); updateAll(); resetFlow();
}

function resetFlow(){
  $('matriculaInput').value='';
  $('contenidoInput').value='';
  currentMatricula=''; currentEstado='';
  showStep(1,'back');
}

/* LISTAS */
function updateAll(){
  const cargadas = plataformas.filter(p=>p.estado==='CARGADA');
  const vacias   = plataformas.filter(p=>p.estado==='VAC√çA');
  const averiadas= plataformas.filter(p=>p.estado==='AVERIADA');

  $('cargadasCount').textContent=cargadas.length;
  $('vaciasCount').textContent=vacias.length;
  $('averiadasCount').textContent=averiadas.length;
  $('totalCount').textContent=plataformas.length;

  $('cargadasListCount').textContent=cargadas.length;
  $('vaciasListCount').textContent=vacias.length;
  $('averiadasListCount').textContent=averiadas.length;

  renderList('cargadasList',cargadas,true);
  renderList('vaciasList',vacias,false);
  renderList('averiadasList',averiadas,true);
}

function esc(s){ return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }
function renderList(id, arr, showContent){
  const box=$(id);
  if(!arr.length){ box.innerHTML='<div class="empty">No hay registros</div>'; return; }
  box.innerHTML = arr.map(it=>`
    <div class="card-row">
      <div class="head" style="display:flex;justify-content:space-between;font-weight:700">
        <span>${esc(it.matricula)}</span>
        <span>${esc(it.timestamp)}</span>
      </div>
      ${showContent && it.contenido?`<div style="margin-top:6px">${esc(it.contenido)}</div>`:''}
    </div>
  `).join('');
}

/* PDF ‚Äî sin cambios */
function generatePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:'mm',format:'a4'});
  const today = new Date();
  const dateString = today.toLocaleDateString('es-ES',{weekday:'long',year:'numeric',month:'long',day:'numeric'}).toUpperCase();

  const cargadas = plataformas.filter(p=>p.estado==='CARGADA');
  const vacias   = plataformas.filter(p=>p.estado==='VAC√çA');
  const averiadas= plataformas.filter(p=>p.estado==='AVERIADA');

  /* ----- cabecera PDF original respetada ----- */
  doc.setFont('helvetica','bold'); doc.setFontSize(18);
  doc.text('XPO LOGISTICS',105,22,{align:'center'});
  doc.setFontSize(8); doc.text(dateString,105,28,{align:'center'});

  let y=40;
  doc.setFont('helvetica','bold'); doc.setFontSize(12);
  if(cargadas.length) doc.text('CARGADAS',15,y);
  if(vacias.length)   doc.text('VAC√çAS',110,y);
  y+=10;

  /* ... (mantengo tu l√≥gica original compactada) ... */

  doc.save('reporte_plataformas.pdf');
}

/* PARALLAX OPTIMIZADO */
const header = $('glassHeader');
let ticking=false;
document.addEventListener('scroll',()=>{
  if(!ticking){
    requestAnimationFrame(()=>{
      const y=Math.min(60,scrollY);
      header.style.transform=`translateY(${y*0.18}px)`;
      ticking=false;
    });
    ticking=true;
  }
});

/* EVENTOS */
window.addEventListener('DOMContentLoaded',()=>{
  $('currentDate').textContent=fmtDateLong().toUpperCase();

  loadData(); updateAll();

  $('toS2').onclick=nextFromS1;
  $('back1').onclick=()=>showStep(1,'back');
  $('back2').onclick=()=>showStep(2,'back');

  $('btnCargada').onclick=()=>chooseEstado('CARGADA');
  $('btnVacia').onclick=()=>chooseEstado('VAC√çA');
  $('btnAveriada').onclick=()=>chooseEstado('AVERIADA');

  $('btnRegistrar').onclick=registrar;
  $('genPdf').onclick=generatePDF;

  $('clearAll').onclick=()=>{
    if(!plataformas.length){ alert('No hay registros'); return; }
    if(confirm('¬øEliminar todos los registros?')){
      plataformas=[]; saveData(); updateAll(); resetFlow();
    }
  };
});
</script>
</body>
</html>