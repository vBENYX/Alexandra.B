<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" name="viewport"/>
<title>XPO — Registro de Plataformas (Apple FX+)</title>
<style>
/* ===== Reset mínimo ===== */
*{text-decoration:none !important;}
*{box-sizing:border-box}html,
h1,h2,h3,h4,p{margin:0}button,input,textarea,select{font:inherit}
img,svg,video{display:block;max-width:100%}

/* ===== Tokens (sin modo oscuro) ===== */
:root{
  --accent:#0A84FF;
  --bg:#F5F6F7;
  --panel:#FFFFFF;
  --line:#E6E6EA;
  --text:#111418;
  --muted:#6A6F75;
  --radius:18px;
  --shadow-1:0 10px 28px rgba(0,0,0,.06);
  --shadow-2:0 4px 18px rgba(0,0,0,.07);
  --ease-snap:cubic-bezier(.22,1,.36,1);
  --ease-soft:cubic-bezier(.25,.8,.25,1);
  --blur:18px;
  --glass:rgba(255,255,255,.68);
  --ok:#34C759;
}

/* Respeto a reduce-motion */
@media (prefers-reduced-motion: reduce){
  *{animation-duration:.001ms !important; animation-iteration-count:1 !important; transition-duration:.001ms !important; scroll-behavior:auto !important}
}

/* ===== Base ===== */
html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility}

input,textarea,button,select{font-size:16px}
button{touch-action:manipulation;-webkit-tap-highlight-color:transparent}

.app{max-width:1040px;margin:0 auto;padding: calc(18px + env(safe-area-inset-top)) 16px calc(28px + env(safe-area-inset-bottom)) 16px}

/* ===== Header ===== */
.header{
  position:sticky; top:12px; z-index:10; border-radius:22px; padding:18px 20px;
  background:var(--glass); border:1px solid rgba(120,120,140,.22);
  backdrop-filter:saturate(1.4) blur(var(--blur));
  box-shadow:var(--shadow-1); overflow:hidden; isolation:isolate; transform:translateZ(0);
}
.header::before{content:""; position:absolute; inset:0; background:linear-gradient(180deg, rgba(10,132,255,.10), transparent 60%)}
.brand{display:flex;align-items:center;justify-content:center;gap:10px;font-weight:500;letter-spacing:.08em}

/* CODE chip translúcido + shimmer */
.chip{
  position:relative; overflow:hidden;
  background:rgba(255,255,255,.68);
  border:1px solid rgba(0,0,0,0.06);
  padding:6px 10px; border-radius:10px; font-weight:800;
  backdrop-filter:saturate(1.8) blur(8px);
  box-shadow:inset 0 0 0 0.5px rgba(255,255,255,.6);
}
.chip::after{
  content:""; position:absolute; top:-50%; left:-30%; width:60%; height:200%;
  background:linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.65) 50%, rgba(255,255,255,0) 100%);
  transform:rotate(12deg);
  animation:shimmer 3.6s infinite linear;
  pointer-events:none;
}
@keyframes shimmer{
  0%{ transform:translateX(-120%) rotate(12deg); }
  100%{ transform:translateX(220%) rotate(12deg); }
}

/* Logo XPO rojo en negrita + LOGISTICS negro, animación de entrada */
.logo-line{display:flex;align-items:center;justify-content:center;gap:4px;font-size:clamp(22px,3.6vw,28px);font-weight:800;letter-spacing:.02em}
.logo-xpo{color:#E53935; font-weight:900; animation:logoPop .7s var(--ease-snap)}
.logo-log{color:#111418; font-weight:900; animation:logoFade .9s var(--ease-soft)}
@keyframes logoPop{0%{transform:translateY(6px) scale(.96); opacity:0} 100%{transform:none;opacity:1}}
@keyframes logoFade{0%{letter-spacing:.12em; opacity:0} 100%{letter-spacing:.02em; opacity:1}}

.headline{margin:4px 0 2px;text-align:center;font-weight:500;font-size:clamp(20px,3.2vw,26px)}

/* ===== Card flujo ===== */
.card{
  background:var(--panel); border:1px solid rgba(0,0,0,0.06); border-radius:var(--radius);
  box-shadow:0 4px 12px rgba(0,0,0,0.05); margin:18px 0; overflow:hidden;
  transition: all 0.22s cubic-bezier(.25,.8,.25,1);
  scroll-margin-top:14px;
}
.card:hover{transform:translateY(-3px); box-shadow:0 10px 32px rgba(0,0,0,.12)}
.card:has(.screen.active:focus-within){outline:2px solid rgba(10,132,255,.18)}
.card-header{
  display:flex;align-items:center;justify-content:space-between;gap:8px;
  padding:12px 16px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#FBFBFD,transparent);
}
.chevron{opacity:.65;user-select:none}
.title-lg{font-weight:600;letter-spacing:.01em}

.card-content{position:relative;min-height:240px; perspective:1000px}
.screen{
  position:absolute; inset:0; padding:18px 16px 18px;
  display:flex; flex-direction:column; gap:12px; align-items:center; justify-content:flex-start;
  opacity:0; transform:translateX(24px) scale(.985); pointer-events:none;
  transition: all 0.22s cubic-bezier(.25,.8,.25,1);
}
.screen.active{opacity:1; transform:none; pointer-events:auto}
.screen.out-left{animation:slideOutL .36s var(--ease-snap)}
.screen.out-right{animation:slideOutR .36s var(--ease-snap)}
@keyframes slideOutL{from{opacity:1;transform:none}to{opacity:0;transform:translateX(-24px) scale(.985)}}
@keyframes slideOutR{from{opacity:1;transform:none}to{opacity:0;transform:translateX(24px) scale(.985)}}

/* Flash de éxito sobre fondo blanco */
.flash-once{
  animation:flashBg .9s var(--ease-soft);
  background:
    radial-gradient(240px 80px at 50% 0%, rgba(52,199,89,.10), transparent 70%),
    linear-gradient(180deg,#FFFFFF, #FFFFFF);
}
@keyframes flashBg{
  0%{box-shadow:inset 0 0 0 0 rgba(52,199,89,.0)}
  40%{box-shadow:inset 0 0 0 80px rgba(52,199,89,.08)}
  100%{box-shadow:inset 0 0 0 0 rgba(52,199,89,.0)}
}

/* Pasos (puntos) */
.steps{display:flex;gap:8px;justify-content:center;padding:8px 0 10px}
.dot{width:10px;height:10px;border-radius:999px;background:#D4D6DA;transition: all 0.22s cubic-bezier(.25,.8,.25,1);transform:scale(1.35)}

/* Meta info limpia */
.meta{display:flex; flex-wrap:wrap; align-items:center; justify-content:center; gap:6px 10px; max-width:560px}
.meta .item{color:var(--muted); font-weight:500; white-space:nowrap}
.meta strong{color:var(--text);}

/* Inputs */
.input,.textarea{
  width:100%;max-width:560px;padding:12px 14px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);background:#fff;
  outline:none;transition: all 0.22s cubic-bezier(.25,.8,.25,1);
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",system-ui;
  font-weight:500;
}
.input:focus,.textarea:focus{border-color:var(--accent);box-shadow:0 0 0 8px rgba(10,132,255,.12);transform:translateY(-1px)}
.textarea{min-height:88px;max-height:220px;resize:vertical}
@media (max-width:480px){ .textarea{min-height:72px}}

/* Botones con tipografía Apple y efecto pulsado */
.row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;width:100%;max-width:560px}
.btn{
  position:relative; display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:11px 14px;border:1px solid rgba(0,0,0,0.06);border-radius:12px;
  color:var(--text);background:#F3F4F6;
  box-shadow:0 1px 0 rgba(0,0,0,.04), 0 8px 20px rgba(0,0,0,.06);
  transition: all 0.22s cubic-bezier(.25,.8,.25,1);
  will-change:transform, box-shadow; overflow:hidden;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",system-ui;
  font-weight:500; letter-spacing:.01em;
}
.btn:hover{background:#E8E9EB;border-color:#D9DCE1}
.btn:active{transform:scale(.98)}
.btn:disabled{opacity:.6;transform:none}
.btn-primary{background:var(--accent);color:#fff;border-color:transparent}
.btn-primary:hover{filter:brightness(0.98)}
.btn-secondary{background:#E9EAED}

/* Efecto pulsado */
.btn::after{
  content:""; position:absolute; left:var(--px,50%); top:var(--py,50%);
  width:0; height:0; border-radius:999px; opacity:0; pointer-events:none;
  background:rgba(255,255,255,.6); transform:translate(-50%,-50%);
}
.btn.pressed::after{ animation:pressPulse .5s var(--ease-snap) forwards; }
@keyframes pressPulse{
  0%{opacity:.45; width:0; height:0}
  70%{opacity:.15; width:200%; height:200%}
  100%{opacity:0; width:260%; height:260%}
}

/* Botones estado: grid exacto 3 columnas */
.row.states{display:grid;grid-template-columns:repeat(3, minmax(0,1fr));gap:10px;width:100%;max-width:560px}
.row.states .btn{width:100%}

/* ===== Panels / Pills ===== */
.panel{background:var(--panel);border:1px solid rgba(0,0,0,0.06);border-radius:var(--radius);padding:18px;box-shadow:0 4px 12px rgba(0,0,0,0.05);margin:18px 0}

/* Pills progresivas mejoradas */
.pills{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.pill{
  position:relative; overflow:hidden; border:1px solid rgba(0,0,0,0.06); border-radius:999px; padding:12px 16px;
  background:linear-gradient(180deg,#FBFBFC,transparent); box-shadow:0 2px 12px rgba(0,0,0,.04)
}
/* Relleno progresivo */
.pill::before{
  content:""; position:absolute; inset:0; width:var(--fill,0%);
  background:linear-gradient(90deg, rgba(10,132,255,.18), rgba(10,132,255,.32));
  transition: all 0.22s cubic-bezier(.25,.8,.25,1);
}
/* Brillo al actualizar */
.pill.update::after{
  content:""; position:absolute; top:0; bottom:0; width:28%; left:-30%;
  background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.7) 50%, rgba(255,255,255,0) 100%);
  filter:blur(1px);
  animation:pillShine 1.1s var(--ease-soft);
}
@keyframes pillShine{ 0%{left:-30%} 100%{left:110%} }
.pill-inner{position:relative; display:flex; align-items:center; justify-content:space-between; gap:10px; z-index:1}
.pill .label{font-weight:500; letter-spacing:.01em; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display"}
.pill .val{font-weight:700; min-width:2.5ch; text-align:right; color:#0A84FF; font-variant-numeric:tabular-nums}

/* ===== Registros compactos ===== */
.compact{background:var(--panel);border:1px solid rgba(0,0,0,0.06);border-radius:var(--radius);box-shadow:0 4px 12px rgba(0,0,0,0.05);}
.compact-header{
  position:sticky; top:12px; z-index:5;
  padding:10px; border-bottom:1px solid var(--line); background:linear-gradient(180deg,#FBFBFD,transparent);
  display:flex; gap:8px; justify-content:center; flex-wrap:wrap;
  border-top-left-radius:var(--radius); border-top-right-radius:var(--radius);
}
.segment{display:inline-flex; background:#F3F4F6; border:1px solid rgba(0,0,0,0.06); border-radius:999px; padding:4px}
.segment button{
  border:0; background:transparent; padding:8px 12px; border-radius:999px; font-weight:500; color:#4B5563;
}
.segment button.active{background:#FFFFFF; border:1px solid rgba(0,0,0,0.06); color:var(--text)}
.segment .badge{font-weight:500; margin-left:6px; color:#0A84FF}
.compact-
.record{
  border:1px solid rgba(0,0,0,0.06); border-radius:12px; padding:12px 12px; margin-bottom:10px; background:#fff;
  display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center;
}
.record .meta{justify-content:flex-start}
.actions{display:flex; gap:6px}
.action-btn{border:1px solid rgba(0,0,0,0.06); background:#F3F4F6; padding:8px 10px; border-radius:10px; font-weight:500}
.action-btn:hover{background:#E8E9EB}

/* Toast de éxito */
.toast{
  position:fixed; left:50%; top:16px; transform:translateX(-50%) translateY(-16px);
  background:rgba(52,199,89,.96); color:#fff; padding:10px 14px; border-radius:12px;
  box-shadow:0 10px 28px rgba(0,0,0,.18); opacity:0; z-index:50;
  border:1px solid rgba(255,255,255,.6);
}
.toast.show{animation:toastIn 1.8s var(--ease-soft)}
@keyframes toastIn{0%{opacity:0; transform:translateX(-50%) translateY(-16px)} 12%{opacity:1; transform:translateX(-50%) translateY(0)} 88%{opacity:1} 100%{opacity:0; transform:translateX(-50%) translateY(-16px)}}

/* Modal edición */
.modal{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:30;
  background:rgba(0,0,0,.18);
}
.modal.open{display:flex}
.modal-card{
  width:min(96vw,560px); background:#fff; border:1px solid rgba(0,0,0,0.06); border-radius:20px; box-shadow:var(--shadow-1);
  padding:16px; display:flex; flex-direction:column; gap:10px;
}
.modal-title{font-weight:500; font-size:18px}
.modal-row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
.modal-actions{display:flex; gap:10px; justify-content:flex-end}
select{padding:12px 14px; border-radius:12px; border:1px solid rgba(0,0,0,0.06); background:#fff}

@media (max-width:640px){ .row .btn{flex:1 1 100%} .modal-row{grid-template-columns:1fr} }

.list-body::before{
content:""; position:sticky; top:0; left:0; right:0; height:20px;
background:linear-gradient(to bottom, rgba(245,246,247,1), rgba(245,246,247,0));
pointer-events:none; z-index:5;}
.list-body::after{
content:""; position:sticky; bottom:0; left:0; right:0; height:20px;
background:linear-gradient(to top, rgba(245,246,247,1), rgba(245,246,247,0));
pointer-events:none; z-index:5;}

/* Rhythm Vertical Enhancements */
:root{
  --space-xxs:4px;
  --space-xs:8px;
  --space-sm:12px;
  --space-md:20px;
  --space-lg:24px;
  --space-xl:32px;
}

/* Titles */
.section-title{
  margin-top:var(--space-lg);
  margin-bottom:var(--space-sm);
}

/* Inputs and labels */
.group{margin-bottom:var(--space-md);}
.group label{margin-bottom:var(--space-xs); display:block;}
input, textarea{
  margin-bottom:var(--space-sm);
  padding:var(--space-sm) var(--space-md);
}

/* Card padding */
.card{
  padding:var(--space-md) var(--space-md);
  margin-bottom:var(--space-lg);
}

/* Pills and summary spacing */
.summary-block{
  margin-top:var(--space-lg);
  margin-bottom:var(--space-lg);
}
.pill{margin-right:var(--space-sm); margin-bottom:var(--space-sm);}

/* Records */
.record{
  padding:var(--space-md);
  margin-bottom:var(--space-sm);
}
.record .top-row{margin-bottom:var(--space-xs);}
.record .content{margin-top:var(--space-xs); margin-bottom:var(--space-sm);}
.record .actions{margin-top:var(--space-xs);}

/* ===== Color Balance Enhancements ===== */

/* Background refinement */

/* Card neutrals */
.card{
  background:#FFFFFF;
  border:1px solid rgba(0,0,0,0.06);
  box-shadow:0 4px 12px rgba(0,0,0,0.05);
}

/* Records */
.record{
  background:#FFFFFF;
  border:1px solid rgba(0,0,0,0.06);
  box-shadow:0 2px 8px rgba(0,0,0,0.04);
}

/* State colors refined */
.state-empty{
  background:rgba(33,131,255,0.10);
  border-color:rgba(33,131,255,0.22);
  color:#1564C0;
}

.state-loaded{
  background:rgba(0,180,135,0.10);
  border-color:rgba(0,180,135,0.22);
  color:#0A8369;
}

.state-broken{
  background:rgba(241,184,58,0.12);
  border-color:rgba(241,184,58,0.22);
  color:#8F6200;
}

/* Pills enhancement */
.pill{
  background:#FFFFFF;
  border:1px solid rgba(0,0,0,0.04);
}

/* Buttons */
.btn-primary{
  background:#0A84FF;
}
.btn-primary:hover{
  background:#0A7AF0;
}
.btn-secondary{
  background:#F3F4F6;
  border:1px solid #E3E4E6;
}
.btn-secondary:hover{
  background:#ECEEF2;
}

/* Inputs */
input, textarea{
  background:#FDFDFD;
  border:1px solid #E5E6E7;
}
input:focus, textarea:focus{
  border-color:#0A84FF;
  box-shadow:0 0 0 2px rgba(10,132,255,0.15);
}

/* ===== Flow Visual Clarity ===== */

/* Step headers */
.step-title{
  font-weight:600;
  margin-bottom:8px;
  position:relative;
  display:inline-block;
}
.step-title.active{
  opacity:1;
}
.step-title.inactive{
  opacity:0.45;
}
.step-title.active::after{
  content:"";
  position:absolute;
  left:0;
  right:0;
  bottom:-2px;
  height:2px;
  background:#0A84FF;
  border-radius:2px;
}

/* Smooth step transitions */
.step-panel{
  opacity:0;
  transform:translateY(6px);
  transition:opacity .22s cubic-bezier(.25,.8,.25,1), transform .22s cubic-bezier(.25,.8,.25,1);
}
.step-panel.visible{
  opacity:1;
  transform:translateY(0);
}

/* Button consistency */
.btn-primary, .btn-secondary{
  height:44px;
  border-radius:10px;
  font-weight:500;
  transition:all .22s cubic-bezier(.25,.8,.25,1);
}

/* Subtitles */
.step-sub{
  font-size:14px;
  opacity:.7;
  margin-bottom:16px;
}

/* Highlight on state selection */
.state-button.selected{
  box-shadow:0 0 0 2px rgba(10,132,255,.35);
  background:rgba(10,132,255,0.08);
}

/* ===== Deep Alignment & Semantic Structure ===== */

/* Master column alignment */
.main-container, .card, .record, .group, .step-panel{
  margin-left:auto;
  margin-right:auto;
  max-width:440px;
}

/* Unified left padding */
.card, .record, .step-panel{
  padding-left:20px;
  padding-right:20px;
}

/* Records internal alignment */
.record{
  display:flex;
  flex-direction:column;
  gap:12px;
}

.record-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.record-matricula{
  font-weight:500;
  font-size:17px;
}

.record-estado{
  font-weight:500;
  opacity:.85;
}

.record-time{
  font-size:13px;
  opacity:.65;
  margin-top:4px;
}

.record-content{
  line-height:1.45;
  margin-top:4px;
}

.record-actions{
  text-align:right;
  margin-top:4px;
}

/* State bar alignment */
.record{
  position:relative;
}
.record::before{
  content:"";
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:3px;
  border-radius:3px;
  background:var(--record-state-color, rgba(0,0,0,0.1));
}

/* Apply state color */
.record.state-empty::before{
  background:rgba(33,131,255,0.45);
}
.record.state-loaded::before{
  background:rgba(0,180,135,0.45);
}
.record.state-broken::before{
  background:rgba(241,184,58,0.55);
}

/* Inputs width alignment */
input, textarea{
  width:100%;
  max-width:100%;
  display:block;
}

/* Step title alignment */
.step-title{
  display:block;
  text-align:left;
  margin-left:0;
}

/* Better spacing in panels */
.step-panel.visible{
  padding-top:12px;
}

/* ===== Cohesión Interna ===== */

/* Whites hierarchy */

.card, .record{background:#FFFFFF;}
input, textarea{background:#FDFDFD;}

/* Borders unified */
.card, .record{border:1px solid rgba(0,0,0,0.06);}
input, textarea{border:1px solid #E5E6E7;}

/* Radii */
.card, .record{border-radius:20px;}
input, textarea, .btn-primary, .btn-secondary{border-radius:14px;}
.state-button, .pill, .state-chip{border-radius:10px;}

/* Typography consistency */
input, textarea, .record-content, .record-time{font-weight:400;}
.btn-primary{font-weight:500;}
.state-chip, .record-matricula{font-weight:500;}
.pill .val{font-weight:600;}
.step-title{font-weight:600;}

/* Animation consistency */
*{transition:all .22s cubic-bezier(.25,.8,.25,1);}

/* Unified component behavior */
.card:hover, .record:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 16px rgba(0,0,0,0.07);
}

/* Semantic internal structure */
.record-header, .record-body, .record-footer{
  display:block;
  width:100%;
}

/* ===== Pulido Maestro ===== */

/* Micro-line-height balance */
body, input, textarea, button, .record-content{
  line-height:1.46;
}

/* Micro-spacings refined */
.record-content{margin-top:4px; margin-bottom:12px;}
.record-time{margin-top:2px;}
.record-actions{margin-top:6px;}

/* Button text vertical centering */
.btn-primary, .btn-secondary{
  display:flex;
  align-items:center;
  justify-content:center;
  padding-top:0; padding-bottom:0;
}

/* Subtle hover-shadows */
.card:hover, .record:hover{
  box-shadow:0 6px 18px rgba(0,0,0,0.07);
}

/* New record gentle entry */
.record{
  animation:recordEntry .3s ease-out;
}
@keyframes recordEntry{
  0%{opacity:0; transform:translateY(8px);}
  100%{opacity:1; transform:translateY(0);}
}

/* Pills counter micro-pulse */
.pill-val-update{
  animation:pulseVal .28s ease-out;
}
@keyframes pulseVal{
  0%{transform:scale(1);}
  45%{transform:scale(1.08);}
  100%{transform:scale(1);}
}

/* Step transitions refined */
.step-panel.visible{
  transition:opacity .20s cubic-bezier(.25,.8,.25,1), transform .20s cubic-bezier(.25,.8,.25,1);
}

/* Slight scroll easing for lists */
.list-

/* Shade on scroll edges */
.list-body::before, .list-body::after{
  opacity:.9;
}

/* ===== Accesibilidad Mejorada ===== */

/* Contrastes suaves pero legibles */
body, input, textarea, .record-content{
  color:#5A5F63;
}
.record-time, .step-sub{
  color:#7A7F85;
}

/* Touch targets ampliados */
.btn-primary, .btn-secondary, .state-button{
  min-height:48px;
  padding:0 18px;
}

/* Input focus claro */
input:focus, textarea:focus{
  border-color:#0A84FF;
  box-shadow:0 0 0 3px rgba(10,132,255,0.20);
}

/* Suave aviso de error */
.input-error{
  border-color:#FF4D4F !important;
  box-shadow:0 0 0 2px rgba(255,77,79,0.20);
}

/* Espacios seguros */
.group{margin-bottom:20px;}
.step-sub{margin-bottom:18px;}

/* Registro más legible */
.record{padding-top:18px; padding-bottom:18px;}
.record-header{margin-bottom:6px;}
.record-content{margin-top:6px; margin-bottom:14px;}

/* Auto-scroll suave */
html{
  scroll-behavior:smooth;
}

/* ===== Step Circles Dynamic Fix ===== */

/* Container for circles */
.step-circles{
  display:flex;
  justify-content:center;
  gap:14px;
  margin-bottom:18px;
  margin-top:10px;
  position:relative;
}

/* Circle base */
.step-circle{
  width:18px;
  height:18px;
  border-radius:50%;
  background:#D7D9DD;
  transition:all .25s cubic-bezier(.25,.8,.25,1);
}

/* Active step */
.step-circle.active{
  background:#0A84FF;
  transform:scale(1.15);
}

/* Past steps */
.step-circle.done{
  background:#6CAEFF;
}

/* Prevent overlap with back button */
.btn-back{
  margin-top:20px !important;
  display:block;
}

/* Ensure circles stay above buttons without overlap */
.step-circles{
  z-index:5;
}

/* Soft pop for active step */
.step-circle.active{
  animation: popStep .28s cubic-bezier(.25,.8,.25,1);
}
@keyframes popStep{
  0%{transform:scale(0.85); background:#0A84FFAA;}
  55%{transform:scale(1.18);}
  100%{transform:scale(1.15);}
}

/* ===== Animated Connecting Line Between Step Circles ===== */
.step-circles{
  position:relative;
}
.step-line{
  position:absolute;
  top:50%;
  left:0;
  right:0;
  height:3px;
  background:rgba(180,188,194,0.45);
  transform:translateY(-50%);
  overflow:hidden;
  border-radius:3px;
}
.step-line-fill{
  height:3px;
  background:#0A84FF;
  width:0%;
  transition:width .32s cubic-bezier(.25,.8,.25,1);
  border-radius:3px;
}

/* Fix overlap between circles and back button */
.step-circles{
  margin-bottom:26px !important;
}
.btn-back{
  margin-top:32px !important;
  position:relative;
  z-index:10;
}

/* ===== Reubicación de círculos de pasos ===== */

/* Move circles higher, above titles */
.step-circles{
  position:relative;
  top:-12px;
  margin-bottom:6px !important;
}

/* Lower title for breathing */
.step-title{
  margin-top:14px;
  display:block;
}

/* Increase padding on step panel top so nothing overlaps */
.step-panel{
  padding-top:32px !important;
}

/* Extra separation for 'estado' step to avoid overlap with back button */
[data-step="2"] .btn-back{
  margin-top:48px !important;
}
[data-step="2"] .step-circles{
  top:-4px !important;
  margin-bottom:18px !important;
}

/* ===== Reubicar círculos debajo del botón Volver en TODOS los pasos ===== */

.step-circles{
  position:relative !important;
  top:0 !important;
  margin-top:38px !important;   /* espacio bajo el botón */
  margin-bottom:16px !important;
}

/* Botón volver con espacio inferior fijo */
.btn-back{
  margin-bottom:10px !important;
  z-index:10;
  position:relative;
}

/* Asegurar separación adicional en paneles */
.step-panel{
  padding-top:20px !important;
}

/* ===== Premium Step Dots Redesign ===== */
.steps{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-top:34px !important;
  padding-top:18px !important;
}

.steps .dot{
  width:12px;
  height:12px;
  border-radius:50%;
  background:#D0D3D8;
  transition:all .28s cubic-bezier(.25,.8,.25,1);
  opacity:.6;
}

/* Active dot */
.steps .dot.active{
  background:#0A84FF;
  transform:scale(1.35);
  opacity:1;
}

/* Completed dots */
.steps .dot.done{
  background:#6CAEFF;
  opacity:.9;
}

/* Soft pop animation */
.steps .dot.active{
  animation:popDot .28s cubic-bezier(.25,.8,.25,1);
}
@keyframes popDot{
  0%{transform:scale(0.85);}
  55%{transform:scale(1.42);}
  100%{transform:scale(1.35);}
}

/* ===== DOTS ENTRADA ESCALONADA ===== */
.steps .dot{
  opacity:0;
  transform:translateY(8px);
  animation:dotEnter .38s ease-out forwards;
}

.steps .dot:nth-child(1){animation-delay:0.05s;}
.steps .dot:nth-child(2){animation-delay:0.13s;}
.steps .dot:nth-child(3){animation-delay:0.21s;}

@keyframes dotEnter{
  0%{opacity:0; transform:translateY(8px);}
  100%{opacity:1; transform:translateY(0);}
}

/* ===== LINEA CONECTIVA ANIMADA ===== */
.steps-wrapper{
  position:relative;
  width:100%;
  display:flex;
  justify-content:center;
  margin-top:0;
}
.steps-line{
  position:absolute;
  top:50%;
  left:calc(50% - 70px);
  width:140px;
  height:3px;
  background:rgba(160,168,175,0.35);
  border-radius:3px;
  overflow:hidden;
}
.steps-line-fill{
  height:100%;
  width:0%;
  background:#0A84FF;
  transition:width .35s cubic-bezier(.25,.8,.25,1);
}

/* === Apple Soft Lux + Light Reflect === */
.card, .panel, .pill, .record, .compact {
    background:
        linear-gradient(180deg,
            rgba(255,255,255,0.45) 0%,
            rgba(255,255,255,0.15) 12%,
            rgba(245,246,250,0.00) 28%
        ),
        linear-gradient(145deg,
            rgba(255,255,255,0.80),
            rgba(245,246,250,0.92)
        );

    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);

    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.65);

    box-shadow:
        inset 0 1px 3px rgba(255,255,255,0.9),
        inset 0 10px 22px rgba(255,255,255,0.25),
        0 12px 28px rgba(0,0,0,0.06),
        0 4px 10px rgba(0,0,0,0.04);

    padding: 16px;
    transition: all 0.25s ease;
}

/* === Global Apple Background === */

/* === Micro-shadows Dynamic === */
.card:hover, .panel:hover, .pill:hover, .record:hover, .compact:hover {
    box-shadow:
        inset 0 1px 3px rgba(255,255,255,0.9),
        inset 0 12px 26px rgba(255,255,255,0.28),
        0 14px 32px rgba(0,0,0,0.08),
        0 4px 12px rgba(0,0,0,0.05);
    transform: translateY(-1px);
}

/* === Hairline Separators === */
.separator, .line, hr {
    border: none;
    border-bottom: 1px solid rgba(0,0,0,0.06);
    margin: 8px 0;
}

/* === Focus Glow iOS === */
input:focus, select:focus, textarea:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(120,180,255,0.35);
    border-radius: 8px;
    transition: box-shadow .18s ease;
}

/* === Micro-transitions === */
.card, .panel, .pill, .record, .compact, input, button {
    transition: all .18s ease, box-shadow .18s ease;
}

/* === Light Reflect on all small elements === */
.pill, .record, .compact {
    background:
        linear-gradient(180deg,
            rgba(255,255,255,0.45) 0%,
            rgba(255,255,255,0.15) 12%,
            rgba(245,246,250,0.00) 28%
        ),
        linear-gradient(145deg,
            rgba(255,255,255,0.80),
            rgba(245,246,250,0.92)
        );
}

/* === Mobile Compact Layout === */
@media(max-width: 480px){
    .card, .panel, .pill, .record, .compact {
        padding: 12px;
        border-radius: 14px;
    }
    button {
        padding: 10px 14px;
    }
}

/* === Apple Silver Inputs === */
input, select, textarea {
    background: linear-gradient(145deg,
        rgba(255,255,255,0.85),
        rgba(245,246,250,0.95)
    );
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.55);
    border-radius: 12px;
    padding: 10px 14px;
    box-shadow:
        inset 0 2px 4px rgba(255,255,255,0.8),
        inset 0 -2px 6px rgba(220,220,230,0.4),
        0 2px 6px rgba(0,0,0,0.04);
    transition: all 0.2s ease;
}

/* Hover */
input:hover, select:hover, textarea:hover {
    box-shadow:
        inset 0 2px 6px rgba(255,255,255,0.9),
        inset 0 -3px 8px rgba(220,220,230,0.5),
        0 3px 10px rgba(0,0,0,0.06);
}

/* Focus */
input:focus, select:focus, textarea:focus {
    outline: none;
    box-shadow:
        inset 0 2px 6px rgba(255,255,255,1),
        inset 0 -3px 10px rgba(220,220,230,0.6),
        0 0 0 3px rgba(140,180,255,0.35),
        0 3px 10px rgba(0,0,0,0.08);
}

/* === Apple Silver Buttons === */
button {
    background: linear-gradient(150deg,
        rgba(255,255,255,0.90),
        rgba(240,240,245,0.95)
    );
    border: 1px solid rgba(255,255,255,0.7);
    border-radius: 14px;
    padding: 12px 18px;
    font-weight: 600;
    box-shadow:
        inset 0 1px 3px rgba(255,255,255,0.85),
        inset 0 6px 12px rgba(255,255,255,0.25),
        0 10px 18px rgba(0,0,0,0.05),
        0 3px 8px rgba(0,0,0,0.03);
    transition: all 0.25s ease;
}

button:hover {
    transform: translateY(-1px);
    box-shadow:
        inset 0 2px 5px rgba(255,255,255,1),
        inset 0 8px 14px rgba(255,255,255,0.35),
        0 12px 26px rgba(0,0,0,0.07),
        0 4px 10px rgba(0,0,0,0.04);
}

button:active {
    transform: scale(0.97);
    box-shadow:
        inset 0 2px 8px rgba(180,180,200,0.55),
        inset 0 4px 10px rgba(200,200,220,0.35),
        0 3px 10px rgba(0,0,0,0.04);
}

/* === Apple Silver Menus === */
select {
    appearance: none;
    background-image: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,240,245,0.95));
    background-repeat: no-repeat;
    background-position: right 12px center;
}

/* === System Typography Apple === */

h1 { font-size:22px; font-weight:600; letter-spacing:-0.3px; }
h2 { font-size:17px; font-weight:500; letter-spacing:-0.2px; }
p, span, div { font-size:15px; font-weight:400; }

/* === Ambient Light Background === */

/* === Header Glass Premium === */
header, .topbar, .navbar {
    background: rgba(255,255,255,0.55);
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    border-bottom: 1px solid rgba(255,255,255,0.4);
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}

/* === Section Entry Animations === */
.card, .panel, .record, .compact, .pill {
    opacity: 0;
    transform: translateY(4px);
    animation: fadeSlideIn .35s ease forwards;
}
@keyframes fadeSlideIn {
    to { opacity:1; transform:translateY(0); }
}

/* === SF Symbol Style Icons (generic class) === */
.icon {
    width: 20px; height:20px;
    opacity:0.68;
    stroke-width:1.6;
}

/* === Smooth Transitions === */
* { transition: all 0.15s ease; }

/* === Dynamic Island === */
#dynamicIsland {
    position: fixed;
    top: 12px;
    left: 50%;
    transform: translateX(-50%) scale(0.92);
    opacity: 0;
    padding: 10px 26px;
    background: rgba(255,255,255,0.72);
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,0.55);
    box-shadow: 0 6px 22px rgba(0,0,0,0.08), inset 0 1px 3px rgba(255,255,255,0.7);
    font-weight: 600;
    color: #333;
    transition: all .35s cubic-bezier(.25,.7,.35,1);
    z-index: 9999;
}
#dynamicIsland.di-show { opacity:1; transform:translateX(-50%) scale(1); }
#dynamicIsland.di-hidden { opacity:0; transform:translateX(-50%) scale(0.92); }

/* === Silver Menus === */
.menu-apple {
    position: absolute;
    top: 100%;
    width: 180px;
    background: linear-gradient(145deg, rgba(255,255,255,0.80), rgba(245,246,250,0.95));
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.55);
    box-shadow: 0 10px 22px rgba(0,0,0,0.10), inset 0 2px 4px rgba(255,255,255,0.7);
    padding: 8px 0;
    transform: scale(0.96);
    opacity: 0;
    pointer-events: none;
    transition: all .25s ease;
    z-index: 5000;
}
.menu-apple.show { transform:scale(1); opacity:1; pointer-events:auto; }
.menu-apple button {
    width:100%; padding:10px 14px; text-align:left;
    background:transparent; border:none;
    font-size:15px; font-weight:500; color:#333; border-radius:10px;
}
.menu-apple button:hover { background:rgba(255,255,255,0.4); }

/* === Dynamic Island — Opción B (morph + progress) === */
#dynamicIsland{
  position:fixed; top:12px; left:50%; transform:translateX(-50%) scale(0.96);
  opacity:0; padding:10px 18px;
  background:linear-gradient(145deg, rgba(255,255,255,0.82), rgba(245,246,250,0.96));
  backdrop-filter:blur(22px); -webkit-backdrop-filter:blur(22px);
  border-radius:18px; border:1px solid rgba(255,255,255,0.6);
  box-shadow:0 10px 28px rgba(0,0,0,0.08), inset 0 1px 3px rgba(255,255,255,0.7);
  font-weight:600; color:#1c1f24; letter-spacing:.01em;
  z-index:9999; isolation:isolate; overflow:hidden;
  min-width:120px; text-align:center;
}
#dynamicIsland.di-show{ opacity:1; transform:translateX(-50%) scale(1); animation:diMorph .35s var(--ease-snap, cubic-bezier(.22,1,.36,1)) both; }
#dynamicIsland.di-hide{ animation:diShrink .32s ease both; }
#dynamicIsland::after{
  /* progress bar */
  content:""; position:absolute; left:10px; right:10px; bottom:6px; height:3px;
  background:rgba(180,188,194,0.45); border-radius:3px; overflow:hidden;
}
#dynamicIsland .bar{
  position:absolute; left:10px; bottom:6px; height:3px; width:0%;
  background:#0A84FF; border-radius:3px; transition:width .2s ease;
}

@keyframes diMorph{
  0%{transform:translateX(-50%) scale(.94); opacity:0}
  60%{transform:translateX(-50%) scale(1.02); opacity:1}
  100%{transform:translateX(-50%) scale(1); opacity:1}
}
@keyframes diShrink{
  0%{transform:translateX(-50%) scale(1); opacity:1}
  100%{transform:translateX(-50%) scale(.96); opacity:0}
}

@media (prefers-reduced-motion: reduce){
  #dynamicIsland{ transition:none; animation:none !important }
}

/* === Universal silver dropdown menu (Opción B) === */
.menu-trigger{
  position:relative;
  border:1px solid rgba(255,255,255,0.6);
  background:linear-gradient(150deg, rgba(255,255,255,0.9), rgba(240,240,245,0.95));
  border-radius:12px; padding:8px 12px; font-weight:600;
  box-shadow:inset 0 1px 3px rgba(255,255,255,.85), 0 6px 14px rgba(0,0,0,.06);
}
.menu-trigger:active{ transform:scale(.98) }

.menu-apple{
  position:absolute; top:calc(100% + 8px); right:0; min-width:200px;
  background:linear-gradient(145deg, rgba(255,255,255,0.86), rgba(245,246,250,0.96));
  backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px);
  border:1px solid rgba(255,255,255,0.65); border-radius:14px; padding:6px;
  box-shadow:0 18px 36px rgba(0,0,0,.12), inset 0 1px 3px rgba(255,255,255,.75);
  transform-origin:top right; transform:scale(.96) translateY(-6px);
  opacity:0; pointer-events:none; transition:all .22s cubic-bezier(.25,.8,.25,1);
  z-index:5000;
}
.menu-apple.show{ transform:scale(1) translateY(0); opacity:1; pointer-events:auto; }
.menu-apple .item{
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 12px; border-radius:10px; font-weight:500; color:#1c1f24;
  border:1px solid transparent;
}
.menu-apple .item:hover{ background:rgba(255,255,255,.55); border-color:rgba(0,0,0,.06); }
.menu-apple .divider{ height:1px; margin:6px 4px; background:rgba(0,0,0,.06); border-radius:1px; }

/* === Apple Premium Action Buttons === */
.action-btn{
    background: linear-gradient(150deg, rgba(255,255,255,0.90), rgba(240,240,245,0.96));
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.65);
    padding: 12px 20px;
    font-weight: 600;
    color: #1c1f24;
    box-shadow:
        inset 0 1px 3px rgba(255,255,255,0.85),
        inset 0 6px 12px rgba(255,255,255,0.25),
        0 10px 18px rgba(0,0,0,0.05),
        0 3px 8px rgba(0,0,0,0.03);
    transition: all .22s ease;
}
.action-btn:hover{
    transform: translateY(-1px);
    box-shadow:
        inset 0 2px 5px rgba(255,255,255,1),
        inset 0 8px 14px rgba(255,255,255,0.35),
        0 12px 26px rgba(0,0,0,0.07),
        0 4px 10px rgba(0,0,0,0.04);
}
.action-btn:active{
    transform: scale(.97);
    box-shadow:
        inset 0 2px 8px rgba(200,200,220,0.55),
        inset 0 4px 10px rgba(220,220,230,0.35),
        0 3px 8px rgba(0,0,0,0.04);
}
.action-btn.danger{
    color:#b00000;
}

/* Sticky bottom on mobile */

}

/* Compact buttons on mobile */
@media(max-width:520px){
  .action-btn{
    padding:10px 14px;
    font-size:14px;
  }
}

/* Micro-reflection */
.action-btn{
    position:relative;
    overflow:hidden;
}
.action-btn::after{
    content:"";
    position:absolute;
    top:0; left:-40%;
    width:40%; height:100%;
    background:linear-gradient(90deg, rgba(255,255,255,0.15), rgba(255,255,255,0));
    transform:skewX(-20deg);
    transition:transform .4s ease, opacity .4s ease;
    opacity:0;
}
.action-btn:hover::after{
    transform:translateX(250%) skewX(-20deg);
    opacity:1;
}

/* === 1. Silver 3D Icons === */
.icon-pdf, .icon-clear {
    background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(200,200,210,0.65));
    mask-size: contain;
    mask-repeat: no-repeat;
}

/* === 3. Animated Glass Header === */
header {
    transition: backdrop-filter .35s ease, box-shadow .35s ease;
}
.scrolled header {
    backdrop-filter: blur(22px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

/* === 4. Tap Feedback iOS === */
.action-btn:active {
    opacity: .85;
    transform: scale(.96);
    transition: transform .08s ease, opacity .08s ease;
}

/* === Compact Premium Buttons === */
.action-btn{
    padding:10px 16px !important;
    border-radius:12px !important;
    font-size:14.5px !important;
    box-shadow:
        inset 0 1px 2px rgba(255,255,255,0.75),
        inset 0 4px 8px rgba(255,255,255,0.18),
        0 6px 14px rgba(0,0,0,0.04),
        0 2px 6px rgba(0,0,0,0.03) !important;
}

/* === Hairline Separator Above Buttons === */

/* === Subtler Shadows & Shine === */
.action-btn:hover{
    box-shadow:
        inset 0 2px 4px rgba(255,255,255,0.9),
        inset 0 6px 10px rgba(255,255,255,0.22),
        0 8px 18px rgba(0,0,0,0.05),
        0 2px 6px rgba(0,0,0,0.04) !important;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Inter",sans-serif;
  background: linear-gradient(to bottom, #ffffff 0%, #f2f3f7 70%, #eaecf2 100%);
  height:100%;
  scroll-behavior:smooth;
}


.brand { gap:22px !important; }
.chip { padding-left:14px !important; padding-right:14px !important; }

/* Animations */
@keyframes popIn {
  0% { opacity:0; transform:translateY(6px) scale(.94); }
  100% { opacity:1; transform:translateY(0) scale(1); }
}
@keyframes fadeSlide {
  0% { opacity:0; letter-spacing:2px; }
  100% { opacity:1; letter-spacing:0px; }
}
.logo-svg .ani-pop { animation: popIn .55s ease-out forwards; }
.logo-svg .ani-fade { animation: fadeSlide .9s ease-out forwards; }


/* Premium Glass Header */
.header{
  background: rgba(255,255,255,0.28) !important;
  backdrop-filter: blur(18px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(18px) saturate(180%) !important;
  border-bottom: 1px solid rgba(255,255,255,0.35);
  box-shadow: 0 8px 24px rgba(0,0,0,0.06);
}

</style>
<style>
/* Compactar registros debajo de los contadores */
.record{
  padding:10px 12px !important;
  margin-bottom:10px !important;
}
.record .meta .item{
  font-size:13px !important;
  margin-bottom:2px !important;
}
.record .content{
  font-size:13px !important;
  margin-top:4px !important;
}
</style>
<style>
/* ================= Responsive ajustes ================= */

/* Móviles: compactar layout */
@media (max-width: 600px){

  .pills{
    grid-template-columns: 1fr !important;
    gap:10px !important;
  }

  .pill{
    padding:14px 16px !important;
  }

  /* Registros compactos */
  .record{
    padding:8px 10px !important;
  }

  .record .meta{
    display:flex;
    flex-direction:column;
    gap:2px;
  }

  .record .meta .item{
    font-size:12.5px !important;
  }

  .record .content{
    font-size:12.5px !important;
  }

  /* Botones de acciones dentro del registro */
  .record .actions{
    display:flex;
    justify-content:flex-end;
    gap:8px;
    margin-top:6px;
  }

  .record .actions button{
    padding:6px 10px !important;
    font-size:12px !important;
  }

  /* Segment buttons */
  .segment button{
    padding:6px 10px !important;
    font-size:13px !important;
  }

  /* Cards del flujo */
  .card{
    padding:14px !important;
  }

  .btn-primary,
  .btn-secondary{
    font-size:14px !important;
    padding:10px !important;
  }

}

/* Tablets: 600–900px */
@media (min-width:600px) and (max-width:900px){
  .pills{
    grid-template-columns: repeat(2, 1fr) !important;
  }
  .record .content{
    font-size:14px;
  }
}

/* Desktop: mantener la estructura pero más aire */
@media (min-width:900px){
  .record{
    padding:12px 14px;
  }
}
</style>
<style>
/* ===== Ultra‑compact Apple "list row" style ===== */
.record{
  padding:8px 12px;
  background:#fff;
  border-bottom:1px solid rgba(0,0,0,.06);
  border-radius:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:2px;
  transition:background .2s;
}
.record:last-child{border-bottom:0}
.record:hover{background:#F7F7F9}

.record .meta{
  display:flex;
  flex-direction:row;
  justify-content:space-between;
  font-size:13px;
  font-weight:500;
}
.record .meta .item{
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:45%;
}

.record .content,
.record .actions{
  display:none;
}

.record.expanded .content{
  display:block;
  padding-top:4px;
  font-size:12.5px;
  opacity:.85;
}
.record.expanded .actions{
  display:flex;
  justify-content:flex-end;
  gap:12px;
  padding-top:6px;
}

.record.expanded{
  background:#fff;
}
</style>
<style>
/* Contenedor de registros con modo colapsado */
.records-collapsed .record{
  display:none;
}
.records-collapsed .record:nth-last-child(-n+3){
  display:flex;
}

/* Botón "Ver todas / Ocultar" */
#toggleAllBtn{
  width:100%;
  margin:12px 0;
  padding:10px 14px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,.1);
  background:#fff;
  font-size:14px;
  font-weight:500;
  text-align:center;
  cursor:pointer;
  transition:background .2s;
}
#toggleAllBtn:hover{
  background:#F1F1F4;
}
</style>
<style>
/* ===== Version C+D — MICRO‑BURBUJAS LISTADAS ===== */

/* Estilo general de la burbuja */
.record{
  background:#FFFFFF;
  border-radius:14px;
  border:1px solid rgba(0,0,0,.08);
  padding:10px 14px;
  margin-bottom:10px;
  box-shadow:0 1px 3px rgba(0,0,0,.06);
  display:flex;
  flex-direction:column;
  gap:3px;
  transition:background .2s ease, box-shadow .2s ease;
}

/* Pequeña elevación al tocar */
.record:active{
  transform:scale(0.98);
}

/* Primera línea: matrícula */
.record .meta .item:nth-child(1){
  font-size:14px;
  font-weight:600;
  color:#111;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* Segunda línea: estado + fecha */
.record .meta .item:nth-child(2){
  font-size:12.5px;
  font-weight:500;
  color:#666;
  opacity:.8;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* Ocultar contenido por defecto */
.record .content,
.record .actions{
  display:none;
}

/* Burbuja expandida */
.record.expanded{
  background:#FFFFFF;
  box-shadow:0 4px 14px rgba(0,0,0,.12);
}

/* Contenido visible al expandir, estilo burbuja interna */
.record.expanded .content{
  display:block;
  margin-top:6px;
  font-size:13px;
  padding:8px 10px;
  background:#F8F8FA;
  border-radius:10px;
  color:#333;
  line-height:1.35;
}

/* Acciones dentro de la burbuja */
.record.expanded .actions{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  margin-top:8px;
}

.record.expanded .actions button{
  font-size:12px;
  padding:6px 12px;
  border-radius:8px;
}
</style>
<style>
.record.expanded .actions{
  display:flex !important;
}
.record.expanded .actions button{
  display:inline-flex !important;
}
</style>
<style>
/* Asegurar que las acciones aparecen */
.record.expanded .actions{
  display:flex !important;
}

/* Botones estilo Apple */
.record.expanded .actions button{
  font-size:12px;
  padding:6px 12px;
  border-radius:8px;
  background:#FFFFFF;
  border:1px solid rgba(0,0,0,.08);
  transition:background .2s;
}
.record.expanded .actions button:hover{
  background:#F2F2F2;
}
</style>
<style>
/* ==== Compact records + last 3 preview (no rompe el flujo) ==== */
#recordsContainer.records-collapsed .record{display:none;}
#recordsContainer.records-collapsed .record:nth-last-child(-n+3){display:block;}

/* Botón toggle */
#toggleAllBtn{
  width:100%; margin:8px 0 6px; padding:8px 12px;
  border-radius:12px; border:1px solid rgba(0,0,0,.10);
  background:#FFFFFF; font-size:14px; font-weight:500;
  cursor:pointer; transition:background .18s ease;
}
#toggleAllBtn:hover{ background:#F4F5F7; }

/* Fila compacta estilo iOS */
.record{
  padding:10px 12px; border:1px solid rgba(0,0,0,.06); border-radius:12px;
  margin-bottom:8px; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,.04);
}
.record .rowline{
  display:flex; gap:8px; align-items:center; justify-content:space-between;
  font-size:13px; font-weight:600; color:#1C1F24;
}
.rowline .mat{max-width:46%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}
.rowline .est{opacity:.85;}
.rowline .ts{font-weight:500; opacity:.65;}

/* Contenido breve, colapsado por defecto */
.record .content{display:none; margin-top:6px; font-size:12.5px; color:#2B2F34; opacity:.9;}

/* Barra de acciones rápida (aparece al activar) */
.quick-actions{
  display:none; gap:8px; justify-content:flex-end; margin-top:8px;
}
.quick-actions .qa{
  padding:6px 10px; border-radius:10px; border:1px solid rgba(0,0,0,.08);
  background:#F7F8FA; font-size:12.5px; font-weight:600;
}
.quick-actions .qa:hover{ background:#EEF0F4; }

/* Estado activo */
.record.active{ box-shadow:0 6px 18px rgba(0,0,0,.10); }
.record.active .content{ display:block; }
.record.active .quick-actions{ display:flex; }

/* Responsive */
@media (max-width:600px){
  .record{ padding:10px 10px; }
  .rowline{ font-size:13px; }
  .quick-actions .qa{ font-size:12px; padding:6px 9px; }
}
</style>
<style>
/* Compact row visual */
.rowline{display:flex;align-items:center;justify-content:space-between;gap:8px;}
.rowline .mat{font-weight:600;max-width:46%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rowline .est{opacity:.85;}
.rowline .ts{opacity:.65;font-size:12px;}
.record{padding:10px 12px;border:1px solid rgba(0,0,0,.06);border-radius:12px;margin-bottom:8px;background:#fff;}
.record .content{font-size:12.5px;margin-top:6px;color:#2B2F34}
.record .actions{display:flex;justify-content:flex-end;gap:8px;margin-top:6px;}
.record .actions .action-btn{padding:6px 10px;font-size:12px;border-radius:10px;border:1px solid rgba(0,0,0,.08);background:#F7F8FA;}
/* Last-3 collapsed view */
.records-collapsed .record{display:none;}
.records-collapsed .record:nth-last-child(-n+3){display:block;}
/* Toggle button */
.list-toggle{width:100%;margin:8px 0 6px;padding:8px 12px;border-radius:12px;border:1px solid rgba(0,0,0,.1);background:#fff;font-weight:500}
.list-toggle:hover{background:#F4F5F7}
</style>
<style>
button{-webkit-user-select:none;user-select:none;}
</style>
</head>
<body>
<div class="di-hidden" id="dynamicIsland"><span id="diText">Acción completada</span><div class="bar" id="diBar"></div></div>
<div class="app">
<!-- Header -->
<header class="header" data-depth="0.18" id="glassHeader">
<div class="brand">
<div class="chip">CODE</div>
<div class="logo-svg">
<svg style="width:150px; height:auto;" viewbox="0 0 260 40">
<text fill="#E30613" font-size="30" font-weight="900" x="0" y="30">
<tspan class="ani-pop">XPO</tspan>
</text>
<text fill="#1c1f24" font-size="30" font-weight="900" x="88" y="30">
<tspan class="ani-fade">LOGISTICS</tspan>
</text>
</svg>
</div>
</div>
<div class="headline">Registro de Plataformas</div>
</header>
<!-- Card de flujo -->
<section aria-live="polite" class="card" id="flowCard">
<div class="card-header">
<div aria-hidden="true" class="chevron">⟨</div>
<div class="title-lg" id="flowTitle">Matrícula</div>
<div aria-hidden="true" class="chevron">⟩</div>
</div>
<div class="card-content" id="screens">
<!-- S1 -->
<div class="screen active" id="s1" tabindex="-1">
<input autocomplete="off" class="input" id="matriculaInput" placeholder="Introduce la matrícula"/>
<div class="row">
<button aria-label="Continuar a Estado" class="btn btn-primary" id="toS2" type="button">Continuar</button>
</div>
</div>
<!-- S2 -->
<div class="screen" id="s2" tabindex="-1">
<div aria-live="polite" class="meta">
<div class="item">Matrícula:</div>
<div class="item"><strong id="matriculaDisplay">—</strong></div>
</div>
<div aria-label="Selecciona estado" class="row states" role="group">
<button class="btn" id="btnCargada" type="button">CARGADA</button>
<button class="btn" id="btnVacia" type="button">VACÍA</button>
<button class="btn" id="btnAveriada" type="button">AVERIADA</button>
</div>
<div class="row">
<button aria-label="Volver a matrícula" class="btn btn-secondary" id="back1" type="button">Volver</button>
</div>
</div>
<!-- S3 -->
<div class="screen" id="s3" tabindex="-1">
<div aria-live="polite" class="meta">
<div class="item">Matrícula:</div>
<div class="item"><strong id="matriculaDisplay2">—</strong></div>
<div class="item">—</div>
<div class="item">Estado:</div>
<div class="item"><strong id="estadoDisplay">—</strong></div>
</div>
<textarea class="textarea" id="contenidoInput" placeholder="Describe el contenido o el problema…"></textarea>
<div class="row">
<button class="btn btn-primary" id="btnRegistrar" type="button">Registrar</button>
<button class="btn btn-secondary" id="back2" type="button">Volver</button>
</div>
</div>
</div>
<div aria-hidden="true" class="steps">
<div class="dot active" id="d1"></div>
<div class="dot" id="d2"></div>
<div class="dot" id="d3"></div>
</div>
</section>
<section class="panel actions" style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:16px;">
<button class="action-btn" id="genPdf">Generar PDF</button>
<button class="action-btn danger" id="clearAll">Limpiar registros</button>
</section>
<!-- Resumen -->
<section class="panel">
<h3 style="text-align:center;margin:0 0 10px;font-size:16px">Resumen del día</h3>
<div class="pills" id="pillsWrap">
<div class="pill" id="pillCargadas" style="--fill:0%">
<div class="pill-inner">
<span class="label">Plataformas cargadas</span>
<span class="val" id="cargadasCount">0</span>
</div>
</div>
<div class="pill" id="pillVacias" style="--fill:0%">
<div class="pill-inner">
<span class="label">Plataformas vacías</span>
<span class="val" id="vaciasCount">0</span>
</div>
</div>
<div class="pill" id="pillAveriadas" style="--fill:0%">
<div class="pill-inner">
<span class="label">Averiadas</span>
<span class="val" id="averiadasCount">0</span>
</div>
</div>
<div class="pill" id="pillTotal" style="--fill:0%">
<div class="pill-inner">
<span class="label">Total</span>
<span class="val" id="totalCount">0</span>
</div>
</div>
</div>
</section>
<!-- Registros compactos con menú fijo -->
<section class="compact" id="compactPanel">
<div class="compact-header">
<div aria-label="Filtrar registros" class="segment" role="tablist">
<button aria-selected="true" class="active" data-tab="TODAS" role="tab" type="button">Todas <span class="badge" id="bAll">0</span></button>
<button data-tab="CARGADA" role="tab" type="button">Cargadas <span class="badge" id="bCargadas">0</span></button>
<button data-tab="VACÍA" role="tab" type="button">Vacías <span class="badge" id="bVacias">0</span></button>
<button data-tab="AVERIADA" role="tab" type="button">Averiadas <span class="badge" id="bAveriadas">0</span></button>
</div>
</div>
<div class="compact-body" id="recordsContainer"></div>
</section>
</div>
<!-- Toast -->
<div class="toast" id="toast">Registro guardado</div>
<!-- Modal de edición -->
<div aria-hidden="true" class="modal" id="editModal">
<div aria-labelledby="editTitle" aria-modal="true" class="modal-card" role="dialog">
<div class="modal-title" id="editTitle">Editar registro</div>
<div class="modal-row">
<input class="input" id="editMatricula" placeholder="Matrícula"/>
<select id="editEstado">
<option value="CARGADA">CARGADA</option>
<option value="VACÍA">VACÍA</option>
<option value="AVERIADA">AVERIADA</option>
</select>
</div>
<textarea class="textarea" id="editContenido" placeholder="Contenido / problema"></textarea>
<div class="modal-actions">
<button class="btn btn-secondary" id="editCancel" type="button">Cancelar</button>
<button class="btn btn-primary" id="editSave" type="button">Guardar</button>
</div>
</div>
</div>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
/* ===== Utils/State ===== */
const $ = (id)=>document.getElementById(id);
const fmtHour = () => new Date().toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
let plataformas = []; let currentMatricula = ''; let currentEstado = '';
let currentTab = 'TODAS'; let editingId = null;

const STORAGE_KEY = 'plataformas-global';
function loadData(){ try{ const raw=localStorage.getItem(STORAGE_KEY); plataformas=raw?JSON.parse(raw):[] }catch(e){ plataformas=[] } }
function saveData(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(plataformas)); }catch(e){} }

/* ===== Mantener tarjeta a la vista ===== */
function keepCardInView(){
  const card = $('flowCard'); if(!card) return;
  const rect = card.getBoundingClientRect();
  if(rect.top < 12 || rect.bottom > (window.innerHeight - 12)){
    card.scrollIntoView({behavior:'smooth', block:'start'});
  }
}

/* ===== Efecto pulsado en botones ===== */
function attachPressedEffect(el){
  el.addEventListener('pointerdown', (ev)=>{
    const r = el.getBoundingClientRect();
    const x = ev.clientX - r.left, y = ev.clientY - r.top;
    el.style.setProperty('--px', x+'px'); el.style.setProperty('--py', y+'px');
    el.classList.add('pressed');
  });
  ['pointerup','pointerleave','pointercancel'].forEach(evt=>{
    el.addEventListener(evt, ()=>setTimeout(()=>el.classList.remove('pressed'), 220));
  });
}

/* ===== Toast ===== */
function toast(msg='Registro guardado'){
  showIsland(msg, 2200);
}

/* ===== Pills: contador animado ===== */
function animateNumber(el, to){
  const from = Number(el.textContent) || 0;
  if(from === to) return;
  const duration = 700, start = performance.now();
  function step(ts){
    const p = Math.min(1, (ts - start)/duration);
    const ease = 1 - Math.pow(1-p, 3); // easeOutCubic
    el.textContent = Math.round(from + (to - from) * ease);
    if(p < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
  // brillo pill
  const pill = el.closest('.pill'); if(pill){ pill.classList.remove('update'); void pill.offsetWidth; pill.classList.add('update'); }
}

/* ===== Flow ===== */
let step = 1;
function showStep(next, dir='forward'){
  const cur = $('s'+step), nxt = $('s'+next); if(!nxt || cur===nxt) return;
  cur.classList.remove('active'); cur.classList.add(dir==='forward' ? 'out-left':'out-right');
  setTimeout(()=>{ cur.classList.remove('out-left','out-right') }, 360);
  nxt.classList.add('active');
  $('d1').classList.toggle('active', next===1); $('d2').classList.toggle('active', next===2); $('d3').classList.toggle('active', next===3);
  $('flowTitle').textContent = next===1 ? 'Matrícula' : next===2 ? 'Estado' : 'Contenido';
  step = next; requestAnimationFrame(()=>{ nxt.focus({preventScroll:true}); keepCardInView(); });
}
function nextFromS1(){
  const m = $('matriculaInput').value.trim().toUpperCase();
  if(!m){ alert('Por favor, introduce una matrícula válida'); keepCardInView(); return; }
  currentMatricula = m; $('matriculaDisplay').textContent = m; $('matriculaDisplay2').textContent = m;
  showStep(2,'forward');
}
function chooseEstado(estado){
  currentEstado = estado; $('estadoDisplay').textContent = estado;
  if(estado==='VACÍA'){
    if(!currentMatricula){ alert('Introduce primero una matrícula válida'); showStep(1,'back'); return; }
    const dup = plataformas.some(p => p.matricula===currentMatricula && p.estado==='VACÍA');
    if(dup){ alert('Esta matrícula ya fue registrada como VACÍA.'); resetFlow(); return; }
    plataformas.push({ id:Date.now(), matricula:currentMatricula, estado, contenido:'', timestamp:fmtHour() });
    saveData(); updateAll(); flashSuccess(); resetFlow(); keepCardInView();
  }else{
    showStep(3,'forward');
  }
}
function registrar(){
  const contenido = $('contenidoInput').value.trim();
  if(!contenido){ alert('Describe el contenido o el problema'); keepCardInView(); return; }
  plataformas.push({ id:Date.now(), matricula:currentMatricula, estado:currentEstado, contenido, timestamp:fmtHour() });
  saveData(); updateAll();
  const btn=$('btnRegistrar'); const prev=btn.textContent;
  btn.disabled=true; btn.textContent='Registrando…';
  setTimeout(()=>{ btn.textContent='Registrado ✓';
    setTimeout(()=>{ btn.disabled=false; btn.textContent=prev; flashSuccess(); resetFlow(); keepCardInView(); }, 600);
  }, 360);
}
function resetFlow(){ $('matriculaInput').value=''; $('contenidoInput').value=''; currentMatricula=''; currentEstado=''; showStep(1,'back'); }

/* Flash visual de éxito en pantalla + toast */
function flashSuccess(){
  const active = document.querySelector('.screen.active');
  if(active){ active.classList.remove('flash-once'); void active.offsetWidth; active.classList.add('flash-once'); }
  toast('Registro guardado');
}

/* ===== Update UI + Pills + Compact List ===== */
function updateAll(){
  const cargadas = plataformas.filter(p=>p.estado==='CARGADA');
  const vacias   = plataformas.filter(p=>p.estado==='VACÍA');
  const averiadas= plataformas.filter(p=>p.estado==='AVERIADA');
  const total = plataformas.length || 1;

  animateNumber($('cargadasCount'), cargadas.length);
  animateNumber($('vaciasCount'),   vacias.length);
  animateNumber($('averiadasCount'),averiadas.length);
  animateNumber($('totalCount'),    plataformas.length);

  setFill('pillCargadas', cargadas.length/total*100);
  setFill('pillVacias',   vacias.length/total*100);
  setFill('pillAveriadas',averiadas.length/total*100);
  setFill('pillTotal',    100);

  // Badges del segmento
  $('bAll').textContent = plataformas.length;
  $('bCargadas').textContent = cargadas.length;
  $('bVacias').textContent = vacias.length;
  $('bAveriadas').textContent = averiadas.length;

  renderCompactList();
}
function setFill(pillId, pct){
  const el = $(pillId); if(!el) return;
  requestAnimationFrame(()=>{ el.style.setProperty('--fill', Math.max(0, Math.min(100, pct)).toFixed(0) + '%'); });
}

function renderCompactList(){
  const box = $('recordsContainer');
  const data = currentTab==='TODAS' ? plataformas : plataformas.filter(p=>p.estado===currentTab);
  if(!box) return;
  if(!data.length){
    box.innerHTML = '<div class="empty">No hay registros</div>';
    return;
  }
  const map = {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#039;'};
  const esc = (s)=>String(s).replace(/[&<>"']/g, m=>map[m]);
  box.innerHTML = data.map(it => `
    <div class="record" data-id="${it.id}">
      <div class="rowline">
        <span class="mat">${esc(it.matricula)}</span>
        <span class="est">${esc(it.estado)}</span>
        <span class="ts">${esc(it.timestamp||'')}</span>
      </div>
      ${it.contenido ? `<div class="content" style="white-space:pre-wrap">${esc(it.contenido)}</div>` : ''}
      <div class="actions">
        <button type="button" class="action-btn" data-action="edit">Editar</button>
        <button type="button" class="action-btn" data-action="delete">Eliminar</button>
      </div>
    </div>
  `).join('');
}
/* ===== Edit/Delete ===== */
function openEditModal(id){
  const it = plataformas.find(p=>p.id===id); if(!it) return;
  editingId = id;
  $('editMatricula').value = it.matricula;
  $('editEstado').value = it.estado;
  $('editContenido').value = it.contenido || '';
  $('editModal').classList.add('open'); $('editModal').setAttribute('aria-hidden','false');
}
function closeEditModal(){
  $('editModal').classList.remove('open'); $('editModal').setAttribute('aria-hidden','true');
  editingId = null;
}
function saveEdit(){
  if(editingId==null) return;
  const idx = plataformas.findIndex(p=>p.id===editingId);
  if(idx<0) return;
  const m = $('editMatricula').value.trim().toUpperCase();
  const e = $('editEstado').value;
  const c = $('editContenido').value.trim();
  if(!m){ alert('La matrícula no puede estar vacía'); return; }
  plataformas[idx].matricula = m;
  plataformas[idx].estado = e;
  plataformas[idx].contenido = c;
  saveData(); updateAll(); closeEditModal(); toast('Registro actualizado');
}
function deleteRecord(id){
  const it = plataformas.find(p=>p.id===id);
  if(!it) return;
  if(!confirm('¿Eliminar este registro?')) return;
  plataformas = plataformas.filter(p=>p.id!==id);
  saveData(); updateAll(); toast('Registro eliminado');
}

/* ===== PDF (badges fijos, 3 en línea) ===== */
function generatePDF(){
  const { jsPDF } = window.jspdf || {};
  if(!jsPDF){ alert('No se pudo cargar jsPDF. Revisa tu conexión.'); return; }
  const doc = new jsPDF({ unit: 'mm', format: 'a4' });
  const TEXT=[17,20,24], MUTED=[106,111,117], LINE=[230,230,234], PANEL=[255,255,255], SOFT=[245,246,247];
  const BADGE_RED=[254,226,226], BADGE_GREEN=[237,249,237], BADGE_ORNG=[255,245,230];

  const cargadas = plataformas.filter(p => p.estado === 'CARGADA');
  const vacias = plataformas.filter(p => p.estado === 'VACÍA');
  const averiadas = plataformas.filter(p => p.estado === 'AVERIADA');

  // Cabecera
  doc.setFillColor(...PANEL); doc.roundedRect(10,8,190,36,5,5,'F');
  doc.setDrawColor(...LINE); doc.roundedRect(10,8,190,36,5,5); doc.setDrawColor(210,210,214); doc.line(10,44,200,44);
  doc.setFont('helvetica','bold'); doc.setFontSize(11); doc.setTextColor(40,40,40); doc.text('CODE', 195, 14, { align: 'right' });
  doc.setFont('helvetica','bold'); doc.setFontSize(18);
  const full = 'XPO LOGISTICS'; const xpoPart = 'XPO '; const startX = 105 - (doc.getTextWidth(full) / 2);
  doc.setTextColor(229,57,53); doc.text(xpoPart, startX, 22); // rojo XPO
  const nextX = startX + doc.getTextWidth(xpoPart);
  doc.setTextColor(...TEXT); doc.text('LOGISTICS', nextX, 22); // negro LOGISTICS

  // ---- Fecha en letras, gris claro, centrada bajo el logo ----
  (function(){
    const fecha = new Date();
    const fechaLarga = fecha.toLocaleDateString('es-ES', {
      weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'
    });
    const fechaFinal = fechaLarga.charAt(0).toUpperCase() + fechaLarga.slice(1);
    doc.setFont('helvetica','normal');
    doc.setFontSize(10);
    doc.setTextColor(150,150,155);
    doc.text(fechaFinal, 105, 28, { align: 'center' });
  })();

  function drawBadge(x,y,w,h,bg,label,num,numColor){
    doc.setFillColor(...bg); doc.roundedRect(x,y,w,h, h/2, h/2, 'F');
    doc.setDrawColor(...LINE); doc.roundedRect(x,y,w,h, h/2, h/2);
    doc.setFont('helvetica','bold'); doc.setFontSize(8.5); doc.setTextColor(...TEXT);
    doc.text(label, x+7, y+h/2+2, { align:'left' });
    doc.setTextColor(...numColor); doc.text(String(num), x+w-7, y+h/2+2, { align:'right' });
  }
  const usable = 180, gap = 8, w = (usable - gap*2)/3, h = 10, y = 32; let x = 15;
  drawBadge(x,y,w,h,BADGE_RED,'CARGADAS',cargadas.length,[180,30,50]); x+=w+gap;
  drawBadge(x,y,w,h,BADGE_GREEN,'VACÍAS',vacias.length,[16,185,129]); x+=w+gap;
  drawBadge(x,y,w,h,BADGE_ORNG,'AVERIADAS',averiadas.length,[200,110,20]);

  // Tablas
  let yPosition = 52; const bottomMargin = 260;
  function createTwoColumnTables(leftTitle,leftData,rightTitle,rightData,startY){
      let currentY=startY; const leftX=15; const rightX=110; const columnWidth=85;
      doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.setTextColor(...TEXT);
      if(leftData.length>0) doc.text((leftTitle+' ('+leftData.length+')').toUpperCase(),leftX,currentY);
      if(rightData.length>0) doc.text((rightTitle+' ('+rightData.length+')').toUpperCase(),rightX,currentY);
      currentY+=8;
      if(leftData.length>0){
          doc.setFillColor(...SOFT); doc.rect(leftX,currentY-4,columnWidth,7,'F');
          doc.setFont('helvetica','bold'); doc.setFontSize(9); doc.setTextColor(...MUTED);
          doc.text('MATRÍCULA',leftX+2,currentY); doc.text('CONTENIDO',leftX+35,currentY);
      }
      if(rightData.length>0){
          doc.setFillColor(...SOFT); doc.rect(rightX,currentY-4,columnWidth,7,'F');
          doc.setFont('helvetica','bold'); doc.setFontSize(9); doc.setTextColor(...MUTED);
          doc.text('MATRÍCULA',rightX+2,currentY);
      }
      currentY+=8; doc.setFont('helvetica','normal'); doc.setFontSize(8); doc.setTextColor(...TEXT);
      const maxRows=Math.max(leftData.length,rightData.length);
      for(let i=0;i<maxRows;i++){
          if(i%2===0){
              if(leftData[i]){doc.setFillColor(252,253,255);doc.rect(leftX,currentY-3,columnWidth,6,'F');}
              if(rightData[i]){doc.setFillColor(252,253,255);doc.rect(rightX,currentY-3,columnWidth,6,'F');}
          }
          if(leftData[i]){
              doc.text(leftData[i].matricula.toUpperCase(),leftX+2,currentY);
              if(leftData[i].contenido){
                  const lines=doc.splitTextToSize(leftData[i].contenido.toUpperCase(),45);
                  doc.text(lines,leftX+35,currentY);
                  if(lines.length>1) currentY+=(lines.length-1)*3;
              }
          }
          if(rightData[i]){ doc.text(rightData[i].matricula.toUpperCase(),rightX+2,currentY); }
          currentY+=6;
          if(currentY>bottomMargin){ doc.addPage(); currentY=30; }
      }
      return currentY+10;
  }
  function createSingleTable(title,data,startY){
      let currentY=startY; if(data.length===0) return currentY;
      doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.setTextColor(...TEXT); doc.text((title+' ('+data.length+')').toUpperCase(),15,currentY); currentY+=8;
      doc.setFillColor(...SOFT); doc.rect(15,currentY-4,180,7,'F');
      doc.setFont('helvetica','bold'); doc.setFontSize(9); doc.setTextColor(...MUTED); doc.text('MATRÍCULA',17,currentY); doc.text('DESCRIPCIÓN',70,currentY); currentY+=8;
      doc.setFont('helvetica','normal'); doc.setFontSize(8); doc.setTextColor(...TEXT);
      data.forEach((platform,index)=>{
          if(index%2===0){doc.setFillColor(252,253,255);doc.rect(15,currentY-3,180,6,'F');}
          doc.text(platform.matricula.toUpperCase(),17,currentY);
          if(platform.contenido){
              const lines=doc.splitTextToSize(platform.contenido.toUpperCase(),120);
              doc.text(lines,70,currentY);
              if(lines.length>1) currentY+=(lines.length-1)*3;
          }
          currentY+=6;
          if(currentY>bottomMargin){ doc.addPage(); currentY=30; }
      });
      return currentY+10;
  }
  if(cargadas.length>0||vacias.length>0){ yPosition=createTwoColumnTables('PLATAFORMAS CARGADAS',cargadas,'PLATAFORMAS VACÍAS',vacias,yPosition); }
  if(averiadas.length>0){ yPosition=createSingleTable('PLATAFORMAS AVERIADAS',averiadas,yPosition); }
  const pageCount=doc.internal.getNumberOfPages();
  for(let i=1;i<=pageCount;i++){
      doc.setPage(i); doc.setFont('helvetica','normal'); doc.setFontSize(8); doc.setTextColor(100,100,110);
      doc.text('© 2025 XPO LOGISTICS – Informe interno',20,285);
      doc.setTextColor(60,90,180);
      doc.textWithLink('https://vbenyx.github.io/XPO-LOGISTICS/', 105, 285, { url: 'https://vbenyx.github.io/XPO-LOGISTICS/', align: 'center' });
      doc.setTextColor(100,100,110); doc.text('Página '+i+' de '+pageCount,190,285,{align:'right'});
  }
  const exportDateForName = new Date().toLocaleDateString('es-ES', { day:'2-digit', month:'2-digit', year:'numeric' }).replace(/\//g,'-');
  doc.save('reporte_plataformas_'+exportDateForName+'.pdf');
}

/* ===== Init ===== */
window.addEventListener('DOMContentLoaded', () => {
  // Flow
  $('toS2').addEventListener('click', nextFromS1);
  $('back1').addEventListener('click', ()=>{ showStep(1,'back'); keepCardInView(); });
  $('back2').addEventListener('click', ()=>{ showStep(2,'back'); keepCardInView(); });
  $('btnCargada').addEventListener('click', ()=>chooseEstado('CARGADA'));
  $('btnVacia').addEventListener('click',   ()=>chooseEstado('VACÍA'));
  $('btnAveriada').addEventListener('click',()=>chooseEstado('AVERIADA'));
  $('btnRegistrar').addEventListener('click', registrar);
  $('genPdf').addEventListener('click', ()=>{ keepCardInView(); generatePDF(); });
  
$('clearAll').addEventListener('pointerdown', ()=>{
  window.__clearHold = setTimeout(()=>{
    if(!plataformas.length){
      showIsland('No hay registros para limpiar');
      return;
    }
    plataformas=[]; saveData(); updateAll(); resetFlow(); keepCardInView();
    showIsland('Registros limpiados');
  }, 900);
});
['pointerup','pointerleave','pointercancel'].forEach(ev=>{
  $('clearAll').addEventListener(ev, ()=> clearTimeout(window.__clearHold));
});

  // Segmented filter
  document.querySelectorAll('.segment button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.segment button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      currentTab = btn.getAttribute('data-tab');
      renderCompactList();
    });
  });

  // Delegación de acciones Edit/Delete
  $('recordsContainer').addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-action]'); if(!btn) return;
    const rec = e.target.closest('.record'); const id = rec ? Number(rec.getAttribute('data-id')) : null;
    if(!id) return;
    const action = btn.getAttribute('data-action');
    if(action==='edit'){ openEditModal(id); }
    else if(action==='delete'){ deleteRecord(id); }
  });

  // Modal edición
  $('editCancel').addEventListener('click', closeEditModal);
  $('editSave').addEventListener('click', saveEdit);
  $('editModal').addEventListener('click', (e)=>{ if(e.target.id==='editModal') closeEditModal(); });

  // Efecto pulsado en todos los botones
  document.querySelectorAll('button').forEach(attachPressedEffect);

  // Datos
  loadData(); updateAll();
});
</script>
<script>
/* Microinteractions typing */
function addTypingMicroInteraction(id){
  const el=document.getElementById(id);
  if(!el) return;
  el.addEventListener('input', ()=>{
    el.classList.remove('typing-pulse');
    void el.offsetWidth;
    el.classList.add('typing-pulse');
  });
}
window.addEventListener('DOMContentLoaded', ()=>{
  addTypingMicroInteraction('matriculaInput');
  addTypingMicroInteraction('contenidoInput');
});
</script><script>
/* ===== Flow Visual Enhancement JS ===== */
function setStepVisual(current){
  const titles = document.querySelectorAll('.step-title');
  titles.forEach(t=>{
    t.classList.remove('active','inactive');
    if(t.dataset.step == current){
      t.classList.add('active');
    } else {
      t.classList.add('inactive');
    }
  });

  const panels = document.querySelectorAll('.step-panel');
  panels.forEach(p=>{
    p.classList.remove('visible');
    if(p.dataset.step == current){
      setTimeout(()=>p.classList.add('visible'),50);
    }
  });
}

/* Auto highlight state buttons */
<!-- old expansion removed -->
  if(e.target.classList.contains('state-button')){
    document.querySelectorAll('.state-button').forEach(b=>b.classList.remove('selected'));
    e.target.classList.add('selected');
  }
});

/* Call after DOM ready */
document.addEventListener('DOMContentLoaded', ()=>{
  // Assuming step 1 on load
  setStepVisual("1");
});
</script><script>
/* Pulsar contador cuando cambia */
function pulseCounter(id){
  const el=document.getElementById(id);
  if(!el) return;
  el.classList.remove('pill-val-update');
  void el.offsetWidth;
  el.classList.add('pill-val-update');
}
</script><script>
/* Auto-focus y auto-scroll en pasos */
document.addEventListener('DOMContentLoaded', ()=>{
  const inputs=document.querySelectorAll('input, textarea');
  inputs.forEach(el=>{
    el.addEventListener('focus', ()=>{
      setTimeout(()=>{el.scrollIntoView({behavior:'smooth', block:'center'});},120);
    });
  });
});

/* Validación suave */
function markError(id){
  const el=document.getElementById(id);
  if(!el) return;
  el.classList.add('input-error');
  setTimeout(()=>el.classList.remove('input-error'),400);
}
</script><script>
/* === Step Circles Dynamic JS === */

function updateStepCircles(step){
  const circles=document.querySelectorAll('.step-circle');
  circles.forEach((c,i)=>{
    const idx=i+1;
    c.classList.remove('active','done');
    if(idx < step) c.classList.add('done');
    setTimeout(()=>{ if(idx === step){ c.classList.add('active'); } }, 120);
  });
}

document.addEventListener('DOMContentLoaded', ()=>{
  updateStepCircles(1);
});</script><script>
/* === Line Animation === */
function updateStepLine(step){
  const fill=document.querySelector('.step-line-fill');
  if(!fill) return;
  const percent = (step-1)/2*100; // for 3 steps
  fill.style.width = percent + "%";
}

const _origUpdateCircles = updateStepCircles;
updateStepCircles = function(step){
  _origUpdateCircles(step);
  setTimeout(()=>updateStepLine(step),150);
};

document.addEventListener('DOMContentLoaded', ()=>{
  updateStepLine(1);
});
</script><script>
/* ===== Premium Dots Dynamic Control ===== */
function updateDots(step){
  const dots=document.querySelectorAll('.steps .dot');
  dots.forEach((d,i)=>{
    const n=i+1;
    d.classList.remove('active','done');
    if(n<step) d.classList.add('done');
    if(n===step) d.classList.add('active');
  });
}

document.addEventListener('DOMContentLoaded', ()=>updateDots(1));
</script><script>
/* ===== SECUENCIA SINCRONIZADA PANEL → DOT ===== */
const originalUpdateDots = updateDots;

updateDots = function(step){
  /* Espera a que el panel haga su transición antes de cambiar los dots */
  setTimeout(()=>{
    originalUpdateDots(step);
  }, 180); /* sincronía suave */
};
</script><script>
/* ===== LINEA ANIMADA CONTROL ===== */
function updateLine(step){
  const fill=document.querySelector('.steps-line-fill');
  if(!fill) return;
  const percent = (step-1)/2*100;
  fill.style.width = percent + "%";
}

/* Sync with dots */
const __orig = updateDots;
updateDots = function(step){
  __orig(step);
  setTimeout(()=>updateLine(step), 120);
};

document.addEventListener('DOMContentLoaded', ()=>updateLine(1));
</script><script>
/* ==== Atenuación de línea al retroceder ==== */
const __origUpdateLine = updateLine;
updateLine = function(step){
  const fill=document.querySelector('.steps-line-fill');
  if(!fill) return;
  const currentWidth = parseFloat(fill.style.width)||0;
  const target = (step-1)/2*100;

  if(target < currentWidth){
    fill.style.transition = "opacity .25s ease-out, width .35s cubic-bezier(.25,.8,.25,1)";
    fill.style.opacity = "0.35";
    setTimeout(()=>{
      fill.style.width = target + "%";
      setTimeout(()=>fill.style.opacity="1", 260);
    },60);
  } else {
    fill.style.transition = "width .35s cubic-bezier(.25,.8,.25,1)";
    fill.style.width = target + "%";
  }
};
</script>
<script>
document.addEventListener('click', ev=>{
  const row = ev.target.closest('.record');
  if(!row) return;
  row.classList.toggle('expanded');
});
</script>
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const wrap = document.getElementById('recordsContainer');
  if(wrap){
    wrap.classList.add('records-collapsed');
  }

  let showingAll = false;

  const btn = document.createElement('button');
  btn.id = 'toggleAllBtn';
  btn.textContent = 'Ver todas';
  wrap.parentNode.insertBefore(btn, wrap);

  btn.addEventListener('click', ()=>{
    showingAll = !showingAll;
    if(showingAll){
      wrap.classList.remove('records-collapsed');
      btn.textContent = 'Ocultar';
    } else {
      wrap.classList.add('records-collapsed');
      btn.textContent = 'Ver todas';
    }
  });
});
</script>
<script>
<!-- old expansion removed -->
  const rec = e.target.closest('.record');
  if(!rec) return;
  rec.classList.toggle('expanded');
});
</script>
<script>
// Expansión inteligente: no cerrar al pulsar Editar o Eliminar
document.addEventListener('click', e=>{

  // Si se pulsa botón de acción → no expandir/cerrar
  if(e.target.closest('.actions button')){
    return;
  }

  // Si se pulsa un registro → expandir/cerrar
  const rec = e.target.closest('.record');
  if(rec){
    rec.classList.toggle('expanded');
  }

});
</script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const wrap = $('recordsContainer');
  if(!wrap) return;

  // Modo "últimas 3"
  if(!wrap.classList.contains('records-collapsed')){
    wrap.classList.add('records-collapsed');
    const btn = document.createElement('button');
    btn.id='toggleAllBtn'; btn.textContent='Ver todas';
    wrap.parentNode.insertBefore(btn, wrap);
    let showingAll = false;
    btn.addEventListener('click', ()=>{
      showingAll = !showingAll;
      wrap.classList.toggle('records-collapsed', !showingAll);
      btn.textContent = showingAll ? 'Ocultar' : 'Ver todas';
    });
  }

  // Expandir/contraer registro tocando la fila (pero no los botones)
  wrap.addEventListener('click', (e)=>{
    const qaBtn = e.target.closest('.qa');
    if(qaBtn) return; // las acciones se manejan abajo

    const row = e.target.closest('.record');
    if(!row) return;
    row.classList.toggle('active');
  });

  // Acciones rápidas
  wrap.addEventListener('click', (e)=>{
    const btn = e.target.closest('.qa');
    if(!btn) return;
    const rec = e.target.closest('.record');
    const id = rec ? Number(rec.getAttribute('data-id')) : null;
    if(!id) return;

    const act = btn.getAttribute('data-action');
    if(act==='edit'){ openEditModal(id); return; }
    if(act==='delete'){ deleteRecord(id); return; }
    if(act==='ask'){
      const q = prompt('Escribe tu pregunta sobre este registro:');
      if(q && q.trim()){
        toast('Pregunta enviada'); // Simple feedback; integra aquí tu canal real si es necesario
      }
      return;
    }
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  const btn = document.getElementById('toggleAllBtn');
  const wrap = document.getElementById('recordsContainer');
  if(btn && wrap){
    // Ensure collapsed by default
    wrap.classList.add('records-collapsed');
    btn.addEventListener('click', function(){
      const collapsed = wrap.classList.toggle('records-collapsed');
      btn.textContent = collapsed ? 'Ver todas' : 'Ocultar';
    });
  }
});
</script>
<script>
function showIsland(text, duration=2200){
  const island=document.getElementById('dynamicIsland');
  const t=document.getElementById('diText');
  const bar=document.getElementById('diBar');
  if(!island||!t||!bar) return;
  t.textContent=text;
  bar.style.width='0%';
  island.classList.remove('di-hide');
  island.classList.remove('di-hidden');
  island.classList.add('di-show');

  const start=performance.now();
  function step(ts){
    const p=Math.min(1,(ts-start)/duration);
    bar.style.width = Math.round(p*100)+'%';
    if(p<1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);

  clearTimeout(window.__islandTimer);
  window.__islandTimer=setTimeout(()=>{
    island.classList.remove('di-show'); island.classList.add('di-hide');
    setTimeout(()=>{ island.classList.remove('di-hide'); island.classList.add('di-hidden'); }, 260);
  }, duration);
}, 2200);
});
function toggleMenu(){
    const m=document.querySelector('.menu-apple');
    m.classList.toggle('show');
}
</script>
<script>
(function(){
  const btn=document.getElementById('moreActionsBtn');
  const menu=document.getElementById('moreActionsMenu');
  if(!btn||!menu) return;

  function openMenu(){
    menu.classList.add('show');
    btn.setAttribute('aria-expanded','true');
    menu.setAttribute('aria-hidden','false');
  }
  function closeMenu(){
    menu.classList.remove('show');
    btn.setAttribute('aria-expanded','false');
    menu.setAttribute('aria-hidden','true');
  }
  btn.addEventListener('click', (e)=>{
    e.stopPropagation();
    if(menu.classList.contains('show')) closeMenu(); else openMenu();
  });
  document.addEventListener('click', ()=>closeMenu());
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMenu(); });

  // Actions
  menu.addEventListener('click', (e)=>{
    const it=e.target.closest('.item'); if(!it) return;
    const act=it.getAttribute('data-act');
    if(act==='pdf'){ const b=document.getElementById('genPdf'); if(b) b.click(); showIsland('Generando PDF…', 1600); }
    if(act==='csv'){ exportCSV(); showIsland('Exportando CSV…', 1600); }
    if(act==='clear'){ const b=document.getElementById('clearAll'); if(b) b.click(); }
    closeMenu();
  });

  // Simple CSV export from plataformas[]
  window.exportCSV = function(){
    try{
      const rows = [['matricula','estado','contenido','hora']].concat(
        (window.plataformas||[]).map(p=>[p.matricula,p.estado,(p.contenido||'').replace(/\n/g,' '),p.timestamp||''])
      );
      const csv = rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='plataformas.csv'; a.click();
    }catch(e){ alert('No se pudo exportar CSV'); }
  }
})();

function showIsland(text = "Acción completada", duration = 1800) {
  const island = document.getElementById("dynamicIsland");
  const textEl = document.getElementById("diText");
  const bar = document.getElementById("diBar");
  if (!island) return;
  textEl.textContent = text;
  island.classList.remove("di-hide");
  island.classList.add("di-show");
  bar.style.width = "0%";
  setTimeout(() => bar.style.width = "100%", 20);
  setTimeout(() => {
    island.classList.remove("di-show");
    island.classList.add("di-hide");
  }, duration);
}

</script>
<script>
window.addEventListener('scroll', ()=>{
    if(window.scrollY>10){
        document.body.classList.add('scrolled');
    } else {
        document.body.classList.remove('scrolled');
    }
});
</script>
<style>
.panel.actions{
    margin-top:18px !important;
}
</style>
<style>
#clearHoldBar{
  position:absolute;
  left:0; bottom:0;
  height:3px; width:0%;
  background:rgba(255,59,48,0.9);
  border-radius:2px;
}
.vision-bubble{
  position:absolute;
  top:-55px;
  left:50%;
  transform:translateX(-50%) scale(0.7);
  padding:10px 18px;
  background:rgba(255,255,255,0.65);
  backdrop-filter:blur(22px) saturate(180%);
  -webkit-backdrop-filter:blur(22px) saturate(180%);
  border-radius:18px;
  font-size:13px;
  color:#000;
  opacity:0;
  pointer-events:none;
  box-shadow:0 8px 20px rgba(0,0,0,0.18);
  transition:transform 0.3s cubic-bezier(.25,.8,.25,1),
             opacity 0.25s ease-out;
}
.vision-bubble.show{
  opacity:1;
  transform:translateX(-50%) scale(1);
}
#clearAll{ position:relative; overflow:visible; }
</style>
<script>

<!-- Replaced: Apple Glass Fullscreen Confirmation Modal for "Eliminar todo" -->
<style>
/* Apple Glass full-screen modal (sheet) */
.apple-modal-overlay{
  position:fixed; inset:0; background:rgba(0,0,0,0.36); backdrop-filter:blur(8px) saturate(1.1);
  display:none; align-items:center; justify-content:center; z-index:99999;
  animation:fadeIn .22s ease forwards;
}
.apple-modal-sheet{
  width:clamp(320px,86%,720px);
  max-height:86vh;
  background:linear-gradient(180deg, rgba(255,255,255,0.88), rgba(245,246,250,0.9));
  -webkit-backdrop-filter: blur(20px); backdrop-filter: blur(20px);
  border-radius:20px;
  box-shadow:0 20px 50px rgba(15,20,30,0.32);
  padding:20px; display:flex; flex-direction:column; gap:14px; overflow:auto;
  transform:translateY(18px) scale(0.995); opacity:0; transition:transform .28s cubic-bezier(.22,1,.36,1), opacity .22s ease;
}
.apple-modal-sheet.show{ transform:none; opacity:1; }
.apple-modal-title{ font-size:20px; font-weight:700; color:#0b1220; }
.apple-modal-desc{ color:#39414a; opacity:.95; font-size:15px; line-height:1.4; }
.apple-modal-actions{ display:flex; gap:12px; justify-content:flex-end; margin-top:6px; flex-wrap:wrap; }
.btn-apple { min-width:120px; padding:12px 14px; border-radius:12px; font-weight:700; border:1px solid rgba(0,0,0,0.06); background:rgba(255,255,255,0.98); cursor:pointer; }
.btn-apple:active{ transform:scale(.995); }
.btn-apple.secondary{ background:transparent; border:1px solid rgba(0,0,0,0.06); color:#0b1220; }
.btn-apple.destructive{ background:linear-gradient(180deg,#FFECEC,#FFD6D6); color:#9b1c1c; border:1px solid rgba(155,28,28,0.08); box-shadow:0 6px 14px rgba(155,28,28,0.06); }
@keyframes fadeIn{ from { opacity:0 } to { opacity:1 } }
</style>

<div id="appleModalOverlay" class="apple-modal-overlay" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="apple-modal-sheet" role="document" aria-labelledby="appleModalTitle">
    <div>
      <div id="appleModalTitle" class="apple-modal-title">Eliminar todos los registros</div>
      <div class="apple-modal-desc">Esta acción borrará <strong>todos</strong> los registros guardados permanentemente. Esta acción <em>no</em> se puede deshacer. Si quieres conservarlos, cancela ahora.</div>
    </div>
    <div style="display:flex;flex-direction:row;gap:12px;align-items:center;justify-content:flex-start;margin-top:6px;">
      <label style="display:inline-flex;align-items:center;gap:8px;font-weight:600;color:#28323a;">
        <input id="confirmCheckbox" type="checkbox" style="width:18px;height:18px;border-radius:6px;"/> Confirmo que quiero eliminar todo
      </label>
    </div>
    <div class="apple-modal-actions">
      <button id="appleCancelBtn" class="btn-apple secondary">Cancelar</button>
      <button id="appleDeleteBtn" class="btn-apple destructive" disabled>Eliminar todo</button>
    </div>
  </div>
</div>

<script>
(function(){
  // Remove previous ephemeral elements added by old script in case they exist
  try{
    const oldBar = document.getElementById('clearHoldBar');
    if(oldBar && oldBar.parentNode) oldBar.parentNode.removeChild(oldBar);
  }catch(e){}
  try{
    document.querySelectorAll('.vision-bubble').forEach(n=>n.remove());
  }catch(e){}

  const overlay = document.getElementById('appleModalOverlay');
  const openBtn = document.getElementById('clearAll');
  const cancelBtn = document.getElementById('appleCancelBtn');
  const deleteBtn = document.getElementById('appleDeleteBtn');
  const checkbox = document.getElementById('confirmCheckbox');

  if(!overlay || !openBtn || !cancelBtn || !deleteBtn) {
    // If essential elements are missing, do nothing but avoid errors
    return;
  }

  function openModal(){
    overlay.style.display='flex';
    document.documentElement.style.overflow='hidden';
    overlay.setAttribute('aria-hidden','false');
    setTimeout(()=> overlay.querySelector('.apple-modal-sheet').classList.add('show'),12);
    // focus management
    checkbox.focus();
    // reset checkbox
    checkbox.checked=false;
    deleteBtn.disabled=true;
  }

  function closeModal(){
    overlay.querySelector('.apple-modal-sheet').classList.remove('show');
    overlay.setAttribute('aria-hidden','true');
    setTimeout(()=>{
      overlay.style.display='none';
      document.documentElement.style.overflow='';
    },260);
    try{ openBtn.focus(); }catch(e){}
  }

  // Open on click
  openBtn.removeEventListener('click', openModal);
  openBtn.addEventListener('click', function(e){
    e.preventDefault();
    openModal();
  });

  // checkbox enables delete
  checkbox.addEventListener('change', function(e){
    deleteBtn.disabled = !checkbox.checked;
  });

  // cancel
  cancelBtn.addEventListener('click', function(e){
    e.preventDefault();
    closeModal();
  });

  // destructive action
  deleteBtn.addEventListener('click', function(e){
    e.preventDefault();
    // safety double-check
    if(!checkbox.checked) return;
    // perform deletion with graceful try/catch calls to existing functions
    try{
      if(!window.plataformas) window.plataformas = [];
      plataformas.length = 0;
    }catch(e){}
    try{ if(typeof saveData === 'function') saveData(); }catch(e){}
    try{ if(typeof updateAll === 'function') updateAll(); }catch(e){}
    try{ if(typeof resetFlow === 'function') resetFlow(); }catch(e){}
    try{ if(typeof keepCardInView === 'function') keepCardInView(); }catch(e){}
    try{ if(typeof toast === 'function') toast('Registros eliminados'); }catch(e){}
    closeModal();
  });

  // close on overlay click outside sheet
  overlay.addEventListener('click', function(ev){
    if(ev.target === overlay) closeModal();
  });

  // keyboard accessibility: Esc to close
  document.addEventListener('keydown', function(ev){
    if(ev.key === 'Escape' && overlay.style.display === 'flex'){
      closeModal();
    }
  });
})();
</script>
<!-- End of modal replacement -->
</script>
</body>
</html>
<style>
section.card#flowCard {
  width: 100% !important;
  max-width: 760px !important;
  margin-left: auto !important;
  margin-right: auto !important;
  box-sizing: border-box !important;
  padding-left: 16px !important;
  padding-right: 16px !important;
}
section.card#flowCard .card-content,
section.card#flowCard .screen {
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
  margin: 0;
}
@media (max-width: 600px){
  section.card#flowCard {
    max-width: 100% !important;
    padding-left: 12px !important;
    padding-right: 12px !important;
    border-radius: 16px !important;
  }
  section.card#flowCard .screen {
    padding: 12px 4px !important;
  }
}
@media (min-width:600px) and (max-width:900px){
  section.card#flowCard {
    max-width: 640px !important;
  }
  section.card#flowCard .screen {
    padding: 18px 10px !important;
  }
}
@media (min-width:900px){
  section.card#flowCard {
    max-width: 760px !important;
  }
  section.card#flowCard .screen {
    padding: 24px 14px !important;
  }
}
</style>
<style>
.panel.actions{
    background: transparent !important;
    box-shadow: none !important;
    border: none !important;
}
</style>
<style>
/* Force all list-related containers to full width */
[class*="list"], [class*="reg"], .list-body, .list-wrap, #list, #registros {
    width:100% !important;
    max-width:100% !important;
}

/* Ensure flex parents don't restrict width */
.list-container, .records, .registros {
    flex: 1 1 100% !important;
}
</style>
<style>
/* ======= FIX C: Registros totalmente adaptables (vertical y horizontal) ======= */

/* 1) Grid fluido para el contenedor de registros */
#recordsContainer{
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
}

/* 2) Escala progresiva por ancho */
@media (min-width: 700px){
  #recordsContainer{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
@media (min-width: 1100px){
  #recordsContainer{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
}

/* 3) Asegurar que las tarjetas se expanden bien y no recortan contenido */
#recordsContainer .record{
  width: 100%;
  min-width: 0;              /* evita overflow por flex/grid */
  display: flex;
  flex-direction: column;
}

/* 4) Texto largo y saltos de línea seguros */
#recordsContainer .record .content,
#recordsContainer .record .meta .item,
#recordsContainer .rowline .mat{
  white-space: normal;
  overflow-wrap: anywhere;
  word-break: break-word;
}

/* 5) Eliminar límites estrechos sólo en pantallas amplias */
@media (min-width: 700px){
  #recordsContainer .record .meta .item{ max-width: 100% !important; }
  #recordsContainer .rowline .mat{ max-width: 100% !important; }
}

/* 6) Evitar colisiones con el header pegajoso del bloque compacto */
#compactPanel{
  contain: content;
}
#compactPanel .compact-body{
  min-width: 0;
}

/* 7) Botones internos en registros: fila envolvente y compacta */
#recordsContainer .record .actions{
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: flex-end;
}
#recordsContainer .record .actions .action-btn{
  flex: 0 1 auto;
}

/* 8) Imágenes/medios embebidos dentro del contenido */
#recordsContainer .record .content img,
#recordsContainer .record .content video,
#recordsContainer .record .content iframe{
  max-width: 100%;
  height: auto;
  display: block;
}

/* 9) Evitar “cortes” de color de fondo creando un único fondo uniforme en body/app */
body{
  background: linear-gradient(to bottom, #ffffff 0%, #f2f3f7 70%, #eaecf2 100%) !important;
}
.app{
  background: transparent;
}
</style>
<style>

/* ==== Dynamic Island FIX visible + sin barra ==== */
#dynamicIsland{
  background: rgba(0,0,0,0.75) !important;
  color: #fff !important;
  border: 1px solid rgba(255,255,255,0.25) !important;
  box-shadow: 0 8px 22px rgba(0,0,0,0.25) !important;
}

/* Ocultar barra progresiva */
#dynamicIsland::after{
  display: none !important;
}
#dynamicIsland .bar{
  display: none !important;
}

</style>
<style>

/* ==== Dynamic Island POP Animation ==== */
@keyframes islandPop {
  0%   { transform: translateX(-50%) scale(0.85); opacity: 0; }
  50%  { transform: translateX(-50%) scale(1.08); opacity: 1; }
  100% { transform: translateX(-50%) scale(1); }
}

#dynamicIsland.di-show {
  animation: islandPop .38s cubic-bezier(.25, .75, .35, 1.4) !important;
}

</style>
<style>

/* ==== Dynamic Island EXIT Animation — SHRINK FADE ==== */
@keyframes islandShrink {
  0%   { transform: translateX(-50%) scale(1); opacity: 1; }
  100% { transform: translateX(-50%) scale(0.86); opacity: 0; }
}

#dynamicIsland.di-hide {
  animation: islandShrink .28s ease-out forwards !important;
}

