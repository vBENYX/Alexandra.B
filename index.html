<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>XPO â€” Registro de Plataformas (Card Flow Â· Refined)</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{
    --accent:#0A84FF;
    --bg:#F5F6F7;
    --panel:#FFFFFF;
    --line:#E6E6EA;
    --text:#101417;
    --muted:#6A6F75;
    --radius:18px;
    --shadow:0 10px 28px rgba(0,0,0,.06);
    --shadow-card:0 4px 18px rgba(0,0,0,.07);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility}
  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",system-ui,Segoe UI,Roboto,Helvetica,Arial;
    background:var(--bg);
    color:var(--text);
    line-height:1.45;
    letter-spacing:.01em;
    font-weight:400; /* nada en negrita por defecto */
  }
  input,textarea,button{font-size:16px}
  button{touch-action:manipulation;-webkit-tap-highlight-color:transparent}

  .app{max-width:1040px;margin:0 auto;padding:calc(18px + env(safe-area-inset-top)) 16px calc(28px + env(safe-area-inset-bottom)) 16px}

  /* Header */
  .header{
    background:var(--panel);
    border:1px solid var(--line);
    border-radius:22px;
    padding:20px 18px;
    box-shadow:var(--shadow);
  }
  .brand{display:flex;align-items:center;justify-content:center;gap:10px;letter-spacing:.08em}
  .chip{background:#F2F3F4;border:1px solid var(--line);padding:6px 10px;border-radius:10px}
  .headline{margin:8px 0 2px;text-align:center;font-size:clamp(19px,3vw,26px);font-weight:600}
  .subtle{text-align:center;color:var(--muted)}

  /* Single Card Flow */
  .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow-card);margin:18px 0;overflow:hidden}
  .card-h{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line);background:#FBFBFD}
  .card-h .t{letter-spacing:.02em}
  .cc{position:relative;min-height:240px}
  .screen{position:absolute;inset:0;padding:16px 14px;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;opacity:0;transform:translateX(24px) scale(.985);pointer-events:none}
  .screen.active{opacity:1;transform:none;pointer-events:auto;animation:slideIn .42s cubic-bezier(.22,1,.36,1)}
  .screen.out-left{animation:slideOutL .34s cubic-bezier(.22,1,.36,1)}
  .screen.out-right{animation:slideOutR .34s cubic-bezier(.22,1,.36,1)}

  @keyframes slideIn{from{opacity:0;transform:translateX(24px) scale(.985)}to{opacity:1;transform:none}}
  @keyframes slideOutL{from{opacity:1;transform:none}to{opacity:0;transform:translateX(-24px) scale(.99)}}
  @keyframes slideOutR{from{opacity:1;transform:none}to{opacity:0;transform:translateX(24px) scale(.99)}}

  .steps{display:flex;gap:8px;justify-content:center;padding:10px 0 8px}
  .dot{width:8px;height:8px;border-radius:999px;background:#D4D6DA;transition:.25s}
  .dot.active{background:var(--accent);transform:scale(1.35)}

  /* Inputs */
  .input,.textarea{
    width:100%;max-width:520px;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;outline:none;
    transition:border-color .22s, box-shadow .22s, transform .12s;
    font-weight:400;
  }
  .input:focus,.textarea:focus{border-color:var(--accent);box-shadow:0 0 0 6px rgba(10,132,255,.12);transform:translateY(-1px)}
  .textarea{min-height:110px;resize:vertical}

  /* Buttons */
  .row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    padding:11px 16px;border:0;border-radius:12px;font-weight:500;color:#fff;background:#1C1C1E;
    box-shadow:0 1px 0 rgba(0,0,0,.04), 0 6px 16px rgba(0,0,0,.10);
    transition:transform .14s, filter .18s;
  }
  .btn:active{transform:scale(.985)}
  .btn:disabled{opacity:.6;transform:none}
  .btn-primary{background:var(--accent)}
  .btn-secondary{background:#8E8E93}
  .btn-danger{background:#C74A44}

  /* Step 2 vertical, suaves (sin colorines) */
  .option{
    width:100%;max-width:360px;display:flex;align-items:center;justify-content:space-between;gap:10px;
    padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;color:var(--text);
    transition:box-shadow .18s, transform .12s, border-color .18s;
    font-weight:500;
  }
  .option:active{transform:scale(.99)}
  .option:hover{box-shadow:var(--shadow-card);border-color:#DADBE0}
  .opt-label{opacity:.9}
  .opt-meta{color:var(--muted);font-size:13px}

  /* Summary & Registros */
  .panel{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow-card);margin:18px 0}
  .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px}
  .stat{background:#FBFBFC;border:1px solid var(--line);border-radius:12px;padding:14px;text-align:center}
  .stat .n{display:block;font-size:clamp(22px,3.5vw,28px);margin-bottom:2px;color:var(--accent);font-weight:600}
  .stat .label{color:var(--muted)}

  /* Registros card con pestaÃ±as */
  .tabs{display:flex;gap:6px;border-bottom:1px solid var(--line);padding:0 6px}
  .tab{
    padding:10px 12px;border:0;background:transparent;cursor:pointer;font-weight:500;color:#4a4f55;border-bottom:2px solid transparent;
  }
  .tab.active{color:#0b0e11;border-color:var(--accent)}
  .table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:12px}
  .row-item{background:#fff;border:1px solid var(--line);border-radius:12px}
  .cell{padding:10px 12px}
  .cell.meta{color:#4a4f55}
  .empty{padding:14px;border:1px dashed var(--line);border-radius:12px;color:var(--muted);text-align:center;font-style:italic;margin-top:12px}

  .actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
  @media (max-width:640px){ .row .btn{flex:1 1 100%} }
</style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="brand"><div class="chip">CODE</div><div>XPO LOGISTICS</div></div>
      <div class="headline">Registro de Plataformas</div>
      <div class="subtle" id="currentDate"></div>
    </header>

    <!-- Single Card Flow -->
    <section class="card" id="flowCard">
      <div class="card-h"><div class="t" id="flowTitle">MatrÃ­cula</div><div style="opacity:.5;font-size:13px" id="hint"></div></div>
      <div class="cc">
        <!-- S1 -->
        <div class="screen active" id="s1" aria-labelledby="flowTitle">
          <div style="font-weight:600">Paso 1: MatrÃ­cula de la plataforma</div>
          <input id="matriculaInput" class="input" autocomplete="off" placeholder="Introduce la matrÃ­cula" />
          <div class="row"><button class="btn btn-primary" id="toS2">Continuar</button></div>
        </div>
        <!-- S2 -->
        <div class="screen" id="s2" aria-labelledby="flowTitle">
          <div style="font-weight:600">Paso 2: Estado</div>
          <div class="option" id="optCarg">
            <div class="opt-label">Cargada</div>
            <div class="opt-meta">requiere contenido</div>
          </div>
          <div class="option" id="optVacia">
            <div class="opt-label">VacÃ­a</div>
            <div class="opt-meta">registro directo</div>
          </div>
          <div class="option" id="optAver">
            <div class="opt-label">Averiada</div>
            <div class="opt-meta">requiere detalle</div>
          </div>
          <div class="row"><button class="btn btn-secondary" id="back1">Volver</button></div>
        </div>
        <!-- S3 -->
        <div class="screen" id="s3" aria-labelledby="flowTitle">
          <div style="font-weight:600">Paso 3: Contenido</div>
          <div class="subtle">MatrÃ­cula: <span id="matriculaDisplay2">â€”</span> â€” Estado: <span id="estadoDisplay">â€”</span></div>
          <textarea id="contenidoInput" class="textarea" placeholder="Describe el contenido o el problemaâ€¦"></textarea>
          <div class="row">
            <button class="btn btn-primary" id="btnRegistrar">Registrar</button>
            <button class="btn btn-secondary" id="back2">Volver</button>
          </div>
        </div>
      </div>
      <div class="steps" aria-hidden="true">
        <div class="dot active" id="d1"></div>
        <div class="dot" id="d2"></div>
        <div class="dot" id="d3"></div>
      </div>
    </section>

    <!-- Resumen -->
    <section class="panel">
      <div class="stats">
        <div class="stat"><span class="n" id="cargadasCount">0</span><div class="label">Cargadas</div></div>
        <div class="stat"><span class="n" id="vaciasCount">0</span><div class="label">VacÃ­as</div></div>
        <div class="stat"><span class="n" id="averiadasCount">0</span><div class="label">Averiadas</div></div>
        <div class="stat"><span class="n" id="totalCount">0</span><div class="label">Total</div></div>
      </div>
    </section>

    <!-- Registros (una sola tarjeta con pestaÃ±as) -->
    <section class="panel" id="registrosCard">
      <div class="tabs">
        <button class="tab active" data-filter="TODAS">Todas</button>
        <button class="tab" data-filter="CARGADA">Cargadas</button>
        <button class="tab" data-filter="VACÃA">VacÃ­as</button>
        <button class="tab" data-filter="AVERIADA">Averiadas</button>
      </div>
      <div id="tableWrap"></div>
    </section>

    <!-- Acciones -->
    <section class="panel actions">
      <button class="btn btn-primary" id="genPdf">ðŸ“„ Generar PDF</button>
      <button class="btn btn-danger" id="clearAll">ðŸ—‘ Limpiar registros</button>
    </section>
  </div>

<script>
  // ===== Helpers & State =====
  const $ = (id)=>document.getElementById(id);
  const fmtDateLong = (d=new Date()) => d.toLocaleDateString('es-ES', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
  const fmtHour = () => new Date().toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit',second:'2-digit'});

  let plataformas = [];
  let currentMatricula = '';
  let currentEstado = '';

  const STORAGE_KEY = 'plataformas-global';
  function loadData(){ try{ const raw=localStorage.getItem(STORAGE_KEY); plataformas=raw?JSON.parse(raw):[] }catch(e){ plataformas=[] } }
  function saveData(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(plataformas)); }catch(e){} }

  // ===== Single Card Flow with transitions =====
  let step = 1;
  function setDots(n){ ['d1','d2','d3'].forEach((id,i)=>$(id).classList.toggle('active', i===n-1)); }
  function setTitle(n){ $('flowTitle').textContent = n===1?'MatrÃ­cula':n===2?'Estado':'Contenido'; }
  function hint(msg){ $('hint').textContent = msg||''; }

  function showStep(next, dir='forward'){
    const cur = $('s'+step), nxt = $('s'+next);
    if(cur===nxt) return;
    cur.classList.remove('active');
    cur.classList.add(dir==='forward' ? 'out-left':'out-right');
    setTimeout(()=>cur.classList.remove('out-left','out-right'), 340);
    nxt.classList.add('active');
    step = next; setDots(step); setTitle(step);
  }

  function nextFromS1(){
    const m = $('matriculaInput').value.trim().toUpperCase();
    if(!m){ alert('Por favor, introduce una matrÃ­cula vÃ¡lida'); return; }
    currentMatricula = m;
    $('matriculaDisplay2') && ($('matriculaDisplay2').textContent = m);
    showStep(2,'forward'); hint('Selecciona el estado');
  }

  function chooseEstado(estado){
    currentEstado = estado;
    $('estadoDisplay') && ($('estadoDisplay').textContent = estado);
    if(estado==='VACÃA'){
      if(!currentMatricula){ alert('Introduce primero una matrÃ­cula vÃ¡lida'); showStep(1,'back'); return; }
      const dup = plataformas.some(p => p.matricula===currentMatricula && p.estado==='VACÃA');
      if(dup){ alert('âš ï¸ Esta matrÃ­cula ya fue registrada como VACÃA.'); resetFlow(); return; }
      plataformas.push({ id:Date.now(), matricula:currentMatricula, estado, contenido:'', timestamp:fmtHour() });
      saveData(); updateAll(); renderTable(activeFilter); resetFlow();
    }else{
      showStep(3,'forward'); hint('AÃ±ade una descripciÃ³n breve');
    }
  }

  function registrar(){
    const contenido = $('contenidoInput').value.trim();
    if(!contenido){ alert('Describe el contenido o el problema'); return; }
    plataformas.push({ id:Date.now(), matricula:currentMatricula, estado:currentEstado, contenido, timestamp:fmtHour() });
    saveData(); updateAll(); renderTable(activeFilter);
    const btn=$('btnRegistrar'); const prev=btn.textContent;
    btn.disabled=true; btn.textContent='Registrandoâ€¦';
    setTimeout(()=>{ btn.textContent='Registrado âœ“'; setTimeout(()=>{ btn.disabled=false; btn.textContent=prev; resetFlow(); }, 800); }, 420);
  }

  function resetFlow(){
    $('matriculaInput').value=''; $('contenidoInput').value='';
    currentMatricula=''; currentEstado=''; showStep(1,'back'); hint('');
  }

  // ===== Summary + Registros card (single) =====
  function updateAll(){
    const cargadas = plataformas.filter(p=>p.estado==='CARGADA');
    const vacias   = plataformas.filter(p=>p.estado==='VACÃA');
    const averiadas= plataformas.filter(p=>p.estado==='AVERIADA');
    $('cargadasCount').textContent=cargadas.length;
    $('vaciasCount').textContent=vacias.length;
    $('averiadasCount').textContent=averiadas.length;
    $('totalCount').textContent=plataformas.length;
  }

  let activeFilter = 'TODAS';
  function renderTable(filter='TODAS'){
    activeFilter = filter;
    const wrap = document.getElementById('tableWrap');
    const data = plataformas.filter(p => filter==='TODAS' ? true : p.estado===filter);
    if(!data.length){ wrap.innerHTML = '<div class="empty">No hay registros</div>'; return; }
    const rows = data.map(p => `
      <tr class="row-item">
        <td class="cell"><strong>${esc(p.matricula)}</strong></td>
        <td class="cell meta">${esc(p.estado)}</td>
        <td class="cell meta">${esc(p.timestamp)}</td>
        <td class="cell">${p.contenido?esc(p.contenido):''}</td>
        <td class="cell" style="width:1%">
          <button aria-label="Eliminar" data-id="${p.id}" class="btn btn-secondary" style="padding:6px 10px">Eliminar</button>
        </td>
      </tr>
    `).join('');
    wrap.innerHTML = `<table class="table"><tbody>${rows}</tbody></table>`;
    // attach delete
    wrap.querySelectorAll('button[data-id]').forEach(b=>{
      b.onclick = () => {
        const id = Number(b.getAttribute('data-id'));
        plataformas = plataformas.filter(p=>p.id!==id);
        saveData(); updateAll(); renderTable(activeFilter);
      };
    });
  }
  const esc = (s)=>String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));

  // ===== EXACT PDF (igual que tu archivo) =====
  function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'mm', format: 'a4' });
      const today = new Date();
      const dateString = today.toLocaleDateString('es-ES', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
      }).toUpperCase();

      const cargadas = plataformas.filter(p => p.estado === 'CARGADA');
      const vacias = plataformas.filter(p => p.estado === 'VACÃA');
      const averiadas = plataformas.filter(p => p.estado === 'AVERIADA');

      // HEADER
      doc.setFillColor(255,255,255);
      doc.roundedRect(10, 8, 190, 36, 5, 5, 'F');
      doc.setDrawColor(220,220,220);
      doc.roundedRect(10, 8, 190, 36, 5, 5);
      doc.setDrawColor(200,200,200);
      doc.line(10, 44, 200, 44);

      doc.setFont('helvetica','bold');
      doc.setFontSize(11);
      doc.setTextColor(40,40,40);
      doc.text('CODE', 195, 14, { align: 'right' });

      doc.setFont('helvetica','bold');
      doc.setFontSize(18);
      const full = 'XPO LOGISTICS';
      const xpoPart = 'XPO ';
      const startX = 105 - (doc.getTextWidth(full) / 2);
      doc.setTextColor(239,68,68);
      doc.text(xpoPart, startX, 22);
      const nextX = startX + doc.getTextWidth(xpoPart);
      doc.setTextColor(0,0,0);
      doc.text('LOGISTICS', nextX, 22);

      doc.setFont('helvetica','normal');
      doc.setFontSize(8);
      doc.setTextColor(120,120,130);
      doc.text(dateString, 105, 28, { align: 'center' });

      const badgeY = 32, badgeWidth = 40, badgeHeight = 8, gap = 8;
      let bx = 105 - (badgeWidth*3 + gap*2)/2;
      function drawCard(x,y,w,h,bg,num,label,numColor){
          doc.setFillColor(...bg);
          doc.roundedRect(x,y,w,h,2,2,'F');
          doc.setFont('helvetica','bold');
          doc.setFontSize(8);
          doc.setTextColor(...numColor);
          doc.text(String(num), x+w*0.3, y+h/2+2, { align: 'center' });
          doc.setFont('helvetica','bold');
          doc.setFontSize(7);
          doc.setTextColor(60,60,70);
          doc.text(label, x+w*0.7, y+h/2+2, { align: 'center' });
      }
      drawCard(bx,badgeY,badgeWidth,badgeHeight,[254,226,226],cargadas.length,'CARGADAS',[180,30,50]); bx+=badgeWidth+gap;
      drawCard(bx,badgeY,badgeWidth,badgeHeight,[237,249,237],vacias.length,'VACÃAS',[16,185,129]); bx+=badgeWidth+gap;
      drawCard(bx,badgeY,badgeWidth,badgeHeight,[255,245,230],averiadas.length,'AVERIADAS',[200,110,20]);

      let yPosition = 52, bottomMargin = 260;
      function createTwoColumnTables(leftTitle,leftData,rightTitle,rightData,startY){
          let currentY=startY, leftX=15, rightX=110, columnWidth=85;
          doc.setFont('helvetica','bold'); doc.setFontSize(12);
          if(leftData.length>0) doc.text(leftTitle.toUpperCase(),leftX,currentY);
          if(rightData.length>0) doc.text(rightTitle.toUpperCase(),rightX,currentY);
          currentY+=8;
          if(leftData.length>0){
              doc.setFillColor(245,247,250); doc.rect(leftX,currentY-4,columnWidth,7,'F');
              doc.setFont('helvetica','bold'); doc.setFontSize(9);
              doc.text('MATRICULA',leftX+2,currentY); doc.text('CONTENIDO',leftX+35,currentY);
          }
          if(rightData.length>0){
              doc.setFillColor(245,247,250); doc.rect(rightX,currentY-4,columnWidth,7,'F');
              doc.setFont('helvetica','bold'); doc.setFontSize(9);
              doc.text('MATRICULA',rightX+2,currentY);
          }
          currentY+=8;
          doc.setFont('helvetica','normal'); doc.setFontSize(8);
          const maxRows=Math.max(leftData.length,rightData.length);
          for(let i=0;i<maxRows;i++){
              if(i%2===0){
                  if(leftData[i]){doc.setFillColor(252,253,255);doc.rect(leftX,currentY-3,columnWidth,6,'F');}
                  if(rightData[i]){doc.setFillColor(252,253,255);doc.rect(rightX,currentY-3,columnWidth,6,'F');}
              }
              if(leftData[i]){
                  doc.text(leftData[i].matricula.toUpperCase(),leftX+2,currentY);
                  if(leftData[i].contenido){
                      const lines=doc.splitTextToSize(leftData[i].contenido.toUpperCase(),45);
                      doc.text(lines,leftX+35,currentY);
                      if(lines.length>1) currentY+=(lines.length-1)*3;
                  }
              }
              if(rightData[i]){ doc.text(rightData[i].matricula.toUpperCase(),rightX+2,currentY); }
              currentY+=6;
              if(currentY>bottomMargin){ doc.addPage(); currentY=30; }
          }
          return currentY+10;
      }
      function createSingleTable(title,data,startY){
          let currentY=startY; if(!data.length) return currentY;
          doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.text(title.toUpperCase(),15,currentY); currentY+=8;
          doc.setFillColor(245,247,250); doc.rect(15,currentY-4,180,7,'F');
          doc.setFont('helvetica','bold'); doc.setFontSize(9); doc.text('MATRICULA',17,currentY); doc.text('DESCRIPCION',70,currentY); currentY+=8;
          doc.setFont('helvetica','normal'); doc.setFontSize(8);
          data.forEach((p,i)=>{
              if(i%2===0){doc.setFillColor(252,253,255);doc.rect(15,currentY-3,180,6,'F');}
              doc.text(p.matricula.toUpperCase(),17,currentY);
              if(p.contenido){
                  const lines=doc.splitTextToSize(p.contenido.toUpperCase(),120);
                  doc.text(lines,70,currentY);
                  if(lines.length>1) currentY+=(lines.length-1)*3;
              }
              currentY+=6;
              if(currentY>bottomMargin){ doc.addPage(); currentY=30; }
          });
          return currentY+10;
      }
      const cargadas = plataformas.filter(p => p.estado === 'CARGADA');
      const vacias = plataformas.filter(p => p.estado === 'VACÃA');
      const averiadas = plataformas.filter(p => p.estado === 'AVERIADA');
      if(cargadas.length>0||vacias.length>0){
          yPosition=createTwoColumnTables('PLATAFORMAS CARGADAS '+cargadas.length,cargadas,'PLATAFORMAS VACÃAS '+vacias.length,vacias,yPosition);
      }
      if(averiadas.length>0){
          yPosition=createSingleTable('PLATAFORMAS AVERIADAS ('+averiadas.length+')',averiadas,yPosition);
      }
      const pageCount=doc.internal.getNumberOfPages();
      for(let i=1;i<=pageCount;i++){
          doc.setPage(i); doc.setFont('helvetica','normal'); doc.setFontSize(8);
          doc.setTextColor(100,100,110); doc.text('Â© 2025 XPO LOGISTICS â€“ Informe interno',20,285);
          doc.setTextColor(60,90,180); doc.textWithLink('https://vbenyx.github.io/XPO-LOGISTICS/',105,285,{ url:'https://vbenyx.github.io/XPO-LOGISTICS/', align:'center' });
          doc.setTextColor(100,100,110); doc.text('PÃ¡gina '+i+' de '+pageCount,190,285,{align:'right'});
      }
      const exportDateForName = new Date().toLocaleDateString('es-ES',{day:'2-digit',month:'2-digit',year:'numeric'}).replace(/\//g,'-');
      doc.save(`reporte_plataformas_${exportDateForName}.pdf`);
  }

  // ===== Init =====
  window.addEventListener('DOMContentLoaded', () => {
    $('currentDate').textContent = fmtDateLong().toUpperCase();
    loadData(); updateAll(); renderTable(activeFilter);

    $('toS2').addEventListener('click', nextFromS1);
    $('back1').addEventListener('click', ()=>showStep(1,'back'));
    $('back2').addEventListener('click', ()=>showStep(2,'back'));
    $('optCarg').addEventListener('click', ()=>chooseEstado('CARGADA'));
    $('optVacia').addEventListener('click', ()=>chooseEstado('VACÃA'));
    $('optAver').addEventListener('click',  ()=>chooseEstado('AVERIADA'));
    $('btnRegistrar').addEventListener('click', registrar);

    // tabs
    document.querySelectorAll('.tab').forEach(t=>{
      t.onclick = () => {
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        renderTable(t.dataset.filter);
      };
    });

    $('genPdf').addEventListener('click', generatePDF);
    $('clearAll').addEventListener('click', ()=>{
      if(!plataformas.length){ alert('No hay registros para limpiar'); return; }
      if(confirm('Â¿Seguro que quieres eliminar todos los registros?')){
        plataformas = []; saveData(); updateAll(); renderTable(activeFilter); resetFlow();
      }
    });

    document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='hidden') saveData(); });
    window.addEventListener('beforeunload', saveData);
  });
</script>
</body>
</html>
