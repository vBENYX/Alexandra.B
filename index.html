<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
<title>XPO Logistics — Registro de Plataformas</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.4/jspdf.plugin.autotable.min.js"></script>

<style>
:root {
  --bg: linear-gradient(180deg,#fff,#f8f9fb 40%,#f3f4f6 100%);
  --card: rgba(255,255,255,.9);
  --ink: #1d1d1f;
  --muted: #86868b;
  --line: rgba(0,0,0,.08);
  --shadow: 0 10px 30px rgba(0,0,0,.06);
  --radius: 18px;
  --bezier: cubic-bezier(.25,.8,.25,1);
  --cargada:#a7e6b0;
  --vacia:#a8c8f9;
  --averiada:#f8b4b4;
}
body {
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","Inter",sans-serif;
  color:var(--ink);
  background:var(--bg);
  overflow-x:hidden;
  -webkit-tap-highlight-color:transparent;
  animation:fadeIn 1s ease both;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:none;}}
*{box-sizing:border-box;}
html{scroll-behavior:smooth;}

/* Header */
header {
  position:sticky;top:0;z-index:20;
  backdrop-filter:blur(20px) saturate(180%);
  background:rgba(255,255,255,.75);
  border-bottom:1px solid rgba(255,255,255,.4);
  transition:all .35s var(--bezier);
}
header.compact{background:rgba(255,255,255,.9);box-shadow:0 6px 18px rgba(0,0,0,.06);}
.header-inner{width:min(1100px,94%);margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:12px;}
.brand{display:flex;align-items:center;gap:10px;padding:10px 14px;background:rgba(255,255,255,.8);border-radius:14px;border:1px solid rgba(0,0,0,.05);box-shadow:0 4px 10px rgba(0,0,0,.04);transition:transform .3s;}
.brand:hover{transform:translateY(-2px);}
.logo-code{background:#111;color:#fff;padding:4px 10px;border-radius:12px;font-weight:800;}
.logo-xpo{font-weight:800;color:#e11d48;}

main{width:min(1100px,94%);margin:24px auto 100px;}

/* Steps */
.steps{
  background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
  padding:24px;border:1px solid rgba(255,255,255,.6);backdrop-filter:blur(12px);
}
.step{display:none;}
.step.active{display:block;animation:fadeUp .4s var(--bezier);}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:none;}}
.progress-dots{display:flex;gap:8px;justify-content:center;margin-bottom:12px;}
.dot{width:10px;height:10px;border-radius:999px;background:#d1d5db;transition:.35s;}
.dot.on{background:#111;transform:scale(1.3);}
.row{display:flex;gap:12px;align-items:center;}
@media(max-width:560px){.row{flex-direction:column;}}

input,textarea{
  width:100%;padding:16px;border-radius:16px;border:1px solid var(--line);
  background:#fff;font-size:17px;transition:border-color .25s, box-shadow .25s;
}
input:focus,textarea:focus{border-color:#0071e3;box-shadow:0 0 0 8px rgba(0,113,227,.12);}
textarea{min-height:120px;resize:vertical;}

/* Buttons */
.btn{border:0;border-radius:14px;padding:14px 22px;font-weight:700;background:linear-gradient(180deg,#111,#2c2c2e);color:#fff;box-shadow:0 4px 14px rgba(0,0,0,.2);font-size:16px;transition:all .25s;}
.btn:hover{transform:translateY(-1px);}
.btn:active{transform:scale(.98);}
.btn.ghost{background:#fff;color:#111;border:1px solid #ddd;box-shadow:none;}

/* Chips */
.chips{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
.chip{padding:12px 16px;border-radius:16px;background:#fff;border:1px solid var(--line);font-weight:800;min-width:110px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.05);transition:all .25s;}
.chip:hover{transform:translateY(-2px);}

/* Stats */
.stats{display:grid;gap:14px;grid-template-columns:repeat(4,1fr);margin-top:20px;}
@media(max-width:760px){.stats{grid-template-columns:repeat(2,1fr);}}
.stat{background:var(--card);border-radius:16px;padding:14px 16px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.5);backdrop-filter:blur(8px);}
.stat .label{color:var(--muted);font-size:13px;}
.stat .value{font-size:24px;font-weight:800;}
.progress{height:6px;background:#eee;border-radius:10px;margin-top:6px;overflow:hidden;}
.fill{height:100%;width:0%;border-radius:10px;transition:width .8s var(--bezier);}
.fill.c{background:var(--cargada);}
.fill.v{background:var(--vacia);}
.fill.a{background:var(--averiada);}

/* Chart container */
.chartbox{margin-top:20px;background:var(--card);padding:20px;border-radius:16px;box-shadow:var(--shadow);backdrop-filter:blur(10px);}

/* Lists */
.search{margin:18px 0;}
.lists{display:grid;gap:14px;grid-template-columns:repeat(3,1fr);}
@media(max-width:900px){.lists{grid-template-columns:1fr;}}
.panel{background:var(--card);border-radius:16px;box-shadow:var(--shadow);overflow:hidden;}
.panel header{padding:12px 14px;border-bottom:1px solid #eee;background:rgba(255,255,255,.9);}
.item{padding:14px 16px;display:grid;grid-template-columns:1fr auto;border-bottom:1px solid #f1f1f1;background:#fff;}
.meta{color:var(--muted);font-size:12px;margin-top:4px;}

/* Toasts */
.toasts{position:fixed;left:50%;transform:translateX(-50%);bottom:90px;display:flex;flex-direction:column;gap:8px;z-index:60;}
.toast{background:#111;color:#fff;padding:12px 16px;border-radius:16px;box-shadow:var(--shadow);animation:toastIn .3s forwards;}
@keyframes toastIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:none;}}

/* Validation */
.ok{border-color:#a7e6b0!important;}
.bad{border-color:#f8b4b4!important;}
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="brand"><span class="logo-code">CODE</span><span class="logo-xpo">XPO Logistics</span></div>
    <small style="color:var(--muted)">Panel de registro</small>
  </div>
</header>

<main>
  <section class="steps">
    <div class="progress-dots"><div class="dot on"></div><div class="dot"></div><div class="dot"></div></div>
    <div class="step active" id="step1">
      <div class="row">
        <input id="matricula" placeholder="Introduce matrícula (ej: 1234-ABC)">
        <button class="btn" id="toStep2">Continuar</button>
      </div>
      <div class="meta" style="margin-top:6px">Formato automático ####-XXX</div>
    </div>
    <div class="step" id="step2">
      <div style="font-weight:900">Matrícula: <span id="matPreview"></span></div>
      <div class="chips">
        <button class="chip" data-estado="CARGADA">CARGADA</button>
        <button class="chip" data-estado="VACÍA">VACÍA</button>
        <button class="chip" data-estado="AVERIADA">AVERIADA</button>
      </div>
      <div style="margin-top:10px"><button class="btn ghost" id="back1">Volver</button></div>
    </div>
    <div class="step" id="step3">
      <textarea id="contenido" placeholder="Contenido o incidencia…"></textarea>
      <div style="display:flex;gap:10px;margin-top:10px;"><button class="btn" id="registrar">Registrar</button><button class="btn ghost" id="back2">Volver</button></div>
    </div>
  </section>

  <div class="chartbox">
    <canvas id="chartResumen" height="180"></canvas>
  </div>

  <section class="stats">
    <div class="stat"><div class="label">Total</div><div class="value" id="total">0</div></div>
    <div class="stat"><div class="label">Cargadas</div><div class="value" id="valC">0</div><div class="progress"><div class="fill c" id="barC"></div></div></div>
    <div class="stat"><div class="label">Vacías</div><div class="value" id="valV">0</div><div class="progress"><div class="fill v" id="barV"></div></div></div>
    <div class="stat"><div class="label">Averiadas</div><div class="value" id="valA">0</div><div class="progress"><div class="fill a" id="barA"></div></div></div>
  </section>

  <div class="search"><input id="buscador" placeholder="Buscar por matrícula o contenido…"></div>
  <section class="lists">
    <article class="panel"><header><strong>Cargadas</strong></header><div id="listC"></div></article>
    <article class="panel"><header><strong>Vacías</strong></header><div id="listV"></div></article>
    <article class="panel"><header><strong>Averiadas</strong></header><div id="listA"></div></article>
  </section>
</main>

<div class="toasts" id="toasts"></div>

<script>
const $=s=>document.querySelector(s),$$=s=>document.querySelectorAll(s);
const inputMat=$("#matricula"),matPreview=$("#matPreview"),contenido=$("#contenido");
const steps=$$(".step"),dots=$$(".dot"),toastBox=$("#toasts");
const listC=$("#listC"),listV=$("#listV"),listA=$("#listA");
const valC=$("#valC"),valV=$("#valV"),valA=$("#valA"),total=$("#total");
const barC=$("#barC"),barV=$("#barV"),barA=$("#barA");
const buscador=$("#buscador");
let chart;const LS_KEY="plataformas-data";
let current={};

function toast(t){const el=document.createElement("div");el.className="toast";el.textContent=t;toastBox.appendChild(el);setTimeout(()=>{el.style.opacity="0";setTimeout(()=>el.remove(),300);},2000);}
function setStep(n){steps.forEach((e,i)=>e.classList.toggle("active",i===n-1));dots.forEach((d,i)=>d.classList.toggle("on",i<n));}
function fmt(v){v=v.toUpperCase().replace(/[^A-Z0-9]/g,"");const n=v.replace(/[^0-9]/g,"").slice(0,4);const l=v.replace(/[^A-Z]/g,"").slice(0,3);return n+(l?"-"+l:"");}
function valid(v){return /^[0-9]{4}-[A-Z]{3}$/.test(v);}
inputMat.oninput=()=>{const f=fmt(inputMat.value);inputMat.value=f;inputMat.classList.remove("ok","bad");if(f.length>=6)inputMat.classList.add(valid(f)?"ok":"bad");};

$("#toStep2").onclick=()=>{const v=inputMat.value.trim();if(!valid(v)){toast("Formato inválido");return;}current.matricula=v;matPreview.textContent=v;setStep(2);}
$("#back1").onclick=()=>setStep(1);$("#back2").onclick=()=>setStep(2);

$$(".chip").forEach(ch=>ch.onclick=()=>{const e=ch.dataset.estado;current.estado=e;if(e==="VACÍA"){save(v="—");toast("Registrada como VACÍA");return;}setStep(3);});
$("#registrar").onclick=()=>{if(!contenido.value.trim()){toast("Contenido requerido");return;}save(contenido.value.trim());toast("Registro guardado");};

function save(txt){const data=load();data.unshift({matricula:current.matricula,estado:current.estado,contenido:txt,timestamp:Date.now()});localStorage.setItem(LS_KEY,JSON.stringify(data));reset();}
function reset(){inputMat.value="";contenido.value="";inputMat.classList.remove("ok","bad");current={};setStep(1);render();}
function load(){try{return JSON.parse(localStorage.getItem(LS_KEY)||"[]");}catch(e){return[];}}

function render(){
  const q=buscador.value.toLowerCase();
  const data=load().filter(x=>!q||x.matricula.toLowerCase().includes(q)||x.contenido.toLowerCase().includes(q));
  const groups={CARGADA:data.filter(x=>x.estado==="CARGADA"),VACÍA:data.filter(x=>x.estado==="VACÍA"),AVERIADA:data.filter(x=>x.estado==="AVERIADA")};
  draw(listC,groups.CARGADA);draw(listV,groups.VACÍA);draw(listA,groups.AVERIADA);
  valC.textContent=groups.CARGADA.length;valV.textContent=groups.VACÍA.length;valA.textContent=groups.AVERIADA.length;total.textContent=data.length;
  const tot=data.length||1;
  barC.style.width=(groups.CARGADA.length/tot*100)+"%";barV.style.width=(groups.VACÍA.length/tot*100)+"%";barA.style.width=(groups.AVERIADA.length/tot*100)+"%";
  renderChart(groups.CARGADA.length,groups.VACÍA.length,groups.AVERIADA.length);
}

function draw(c,items){c.innerHTML=items.length?items.map(x=>`<div class='item'><div><b>${x.matricula}</b><div class='meta'>${x.contenido}</div></div></div>`).join(""):"<div class='meta'>Sin registros…</div>";}

function renderChart(c,v,a){
  const ctx=document.getElementById("chartResumen");
  const data={labels:["Cargadas","Vacías","Averiadas"],datasets:[{data:[c,v,a],backgroundColor:["#a7e6b0","#a8c8f9","#f8b4b4"],hoverOffset:8,borderWidth:0}]};
  const opts={plugins:{legend:{display:true,labels:{color:"#444",font:{size:13}}}},cutout:"65%"};
  if(chart){chart.data=data;chart.update();}else{chart=new Chart(ctx,{type:"doughnut",data,options:opts});}
}
buscador.oninput=render;
render();
})();
</script>
</body>
</html>