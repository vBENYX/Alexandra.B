<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>XPO ‚Äî Registro de Plataformas (Card Flow)</title>

<!-- Normalize for consistent base -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{
    --accent:#0A84FF;
    --bg:#F5F6F7;
    --panel:#FFFFFF;
    --line:#E6E6EA;
    --text:#111418;
    --muted:#6A6F75;
    --ok:#34C759;
    --warn:#FF9F0A;
    --danger:#FF3B30;
    --radius:18px;
    --shadow:0 10px 28px rgba(0,0,0,.06);
    --shadow-card:0 4px 18px rgba(0,0,0,.07);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility}
  body{
    margin:0;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", system-ui, Segoe UI, Roboto, Helvetica, Arial;
    background:var(--bg);
    color:var(--text);
    line-height:1.45;
    letter-spacing:.01em;
  }
  input,textarea,button{font-size:16px} /* evita zoom en iOS */
  button{touch-action:manipulation;-webkit-tap-highlight-color:transparent}

  .app{
    max-width:1040px;margin:0 auto;
    padding: calc(18px + env(safe-area-inset-top)) 16px calc(28px + env(safe-area-inset-bottom)) 16px;
  }

  /* Header */
  .header{
    background:var(--panel);
    border:1px solid var(--line);
    border-radius:22px;
    padding:22px 20px;
    box-shadow:var(--shadow);
    position:relative;
    overflow:hidden;
    isolation:isolate;
  }
  .header::before{
    content:"";
    position:absolute;inset:0;
    background:linear-gradient(180deg, rgba(10,132,255,.08),transparent 50%);
    pointer-events:none;z-index:-1;
  }
  .brand{display:flex;align-items:center;justify-content:center;gap:10px;font-weight:800;letter-spacing:.12em}
  .chip{background:#F2F3F4;border:1px solid var(--line);padding:6px 10px;border-radius:10px;font-weight:800}
  .headline{margin:8px 0 4px;text-align:center;font-weight:800;font-size:clamp(20px,3.3vw,28px)}
  .subtle{text-align:center;color:var(--muted);font-weight:600}

  /* Single Card Flow */
  .card{
    background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);
    box-shadow:var(--shadow-card);padding:0;margin:18px 0;overflow:hidden;
  }
  .card-header{
    display:flex;align-items:center;justify-content:space-between;gap:8px;
    padding:14px 16px;border-bottom:1px solid var(--line);background:#FBFBFD;
  }
  .chevron{opacity:.65;user-select:none}
  .title-lg{font-weight:800;letter-spacing:.02em}
  .card-content{position:relative;min-height:260px}
  .screen{
    position:absolute;inset:0;padding:18px 16px;
    display:flex;flex-direction:column;gap:14px;align-items:center;justify-content:center;
    opacity:0;transform:translateX(24px) scale(.98);pointer-events:none;
  }
  .screen.active{opacity:1;transform:none;pointer-events:auto;animation:slideIn .44s cubic-bezier(.22,1,.36,1)}
  .screen.out-left{animation:slideOutL .36s cubic-bezier(.22,1,.36,1)}
  .screen.out-right{animation:slideOutR .36s cubic-bezier(.22,1,.36,1)}

  @keyframes slideIn{from{opacity:0;transform:translateX(24px) scale(.98)}to{opacity:1;transform:none}}
  @keyframes slideOutL{from{opacity:1;transform:none}to{opacity:0;transform:translateX(-24px) scale(.985)}}
  @keyframes slideOutR{from{opacity:1;transform:none}to{opacity:0;transform:translateX(24px) scale(.985)}}

  .steps{display:flex;gap:8px;justify-content:center;padding:10px 0 2px}
  .dot{width:10px;height:10px;border-radius:999px;background:#D4D6DA;transition:.25s}
  .dot.active{background:var(--accent);transform:scale(1.35)}

  .input,.textarea{
    width:100%;max-width:520px;padding:14px 16px;border-radius:12px;border:1px solid var(--line);background:#fff;
    outline:none;transition:border-color .22s, box-shadow .22s, transform .12s;
  }
  .input:focus,.textarea:focus{border-color:var(--accent);box-shadow:0 0 0 6px rgba(10,132,255,.12);transform:translateY(-1px)}
  .textarea{min-height:120px;resize:vertical}

  .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    padding:12px 18px;border:0;border-radius:12px;font-weight:700;color:#fff;background:#1C1C1E;
    box-shadow:0 1px 0 rgba(0,0,0,.04), 0 8px 20px rgba(0,0,0,.10);
    transition:transform .14s, filter .18s;
  }
  .btn:active{transform:scale(.985)}
  .btn:disabled{opacity:.6;transform:none}
  .btn-primary{background:var(--accent)}
  .btn-secondary{background:#8E8E93}
  .btn-danger{background:var(--danger)}
  .btn-cargada{background:var(--danger)}
  .btn-vacia{background:var(--ok)}
  .btn-averiada{background:var(--warn)}

  /* Stats & Lists */
  .panel{
    background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);
    padding:18px;box-shadow:var(--shadow-card);margin:18px 0;
  }
  .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
  .stat{background:#FBFBFC;border:1px solid var(--line);border-radius:12px;padding:16px;text-align:center}
  .stat .n{display:block;font-size:clamp(24px,4vw,32px);font-weight:800;margin-bottom:2px;color:var(--accent)}
  .stat .label{color:var(--muted);font-weight:600}
  .lists{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
  .list h3{margin:0 0 10px;font-size:16px}
  .empty{padding:14px;border:1px dashed var(--line);border-radius:12px;color:var(--muted);text-align:center;font-style:italic}
  .card-row{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px 14px;margin-bottom:10px;transition:transform .18s, box-shadow .18s}
  .card-row:hover{transform:translateY(-1px);box-shadow:var(--shadow-card)}
  .head{display:flex;justify-content:space-between;gap:10px;font-weight:700}
  .body{color:#2B2F34;margin-top:6px;white-space:pre-wrap}

  .actions{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}

  @media (max-width:640px){
    .row .btn{flex:1 1 100%}
  }
</style>
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="brand">
        <div class="chip">CODE</div>
        <div>XPO LOGISTICS</div>
      </div>
      <div class="headline">Registro de Plataformas</div>
      <div class="subtle" id="currentDate"></div>
    </header>

    <!-- Single Card Flow -->
    <section class="card" id="flowCard">
      <div class="card-header">
        <div class="chevron">‚ü®</div>
        <div class="title-lg" id="flowTitle">Matr√≠cula</div>
        <div class="chevron">‚ü©</div>
      </div>
      <div class="card-content" id="screens">
        <!-- Screen 1 -->
        <div class="screen active" id="s1">
          <h2 style="margin:0;font-weight:800;font-size:18px">Paso 1: Matr√≠cula de la plataforma</h2>
          <input id="matriculaInput" class="input" autocomplete="off" placeholder="Introduce la matr√≠cula" />
          <button class="btn btn-primary" id="toS2">Continuar</button>
        </div>
        <!-- Screen 2 -->
        <div class="screen" id="s2">
          <h2 style="margin:0;font-weight:800;font-size:18px">Paso 2: Estado</h2>
          <p class="subtle">Matr√≠cula: <strong id="matriculaDisplay">‚Äî</strong></p>
          <div class="row">
            <button class="btn btn-cargada" id="btnCargada">CARGADA</button>
            <button class="btn btn-vacia" id="btnVacia">VAC√çA</button>
            <button class="btn btn-averiada" id="btnAveriada">üõ† AVERIADA</button>
          </div>
          <div class="row">
            <button class="btn btn-secondary" id="back1">Volver</button>
          </div>
        </div>
        <!-- Screen 3 -->
        <div class="screen" id="s3">
          <h2 style="margin:0;font-weight:800;font-size:18px">Paso 3: Contenido</h2>
          <p class="subtle">Matr√≠cula: <strong id="matriculaDisplay2">‚Äî</strong> ‚Äî Estado: <strong id="estadoDisplay">‚Äî</strong></p>
          <textarea id="contenidoInput" class="textarea" placeholder="Describe el contenido o el problema‚Ä¶"></textarea>
          <div class="row">
            <button class="btn btn-primary" id="btnRegistrar">Registrar</button>
            <button class="btn btn-secondary" id="back2">Volver</button>
          </div>
        </div>
      </div>
      <div class="steps" aria-hidden="true">
        <div class="dot active" id="d1"></div>
        <div class="dot" id="d2"></div>
        <div class="dot" id="d3"></div>
      </div>
    </section>

    <!-- Summary -->
    <section class="panel">
      <h3 style="text-align:center;margin:0 0 10px;font-size:16px">Resumen del d√≠a</h3>
      <div class="stats">
        <div class="stat"><span class="n" id="cargadasCount">0</span><span class="label">Plataformas cargadas</span></div>
        <div class="stat"><span class="n" id="vaciasCount">0</span><span class="label">Plataformas vac√≠as</span></div>
        <div class="stat"><span class="n" id="averiadasCount">0</span><span class="label">üõ† Averiadas</span></div>
        <div class="stat"><span class="n" id="totalCount">0</span><span class="label">Total</span></div>
      </div>
    </section>

    <!-- Lists -->
    <section class="panel">
      <div class="lists">
        <div class="list">
          <h3>Plataformas cargadas (<span id="cargadasListCount">0</span>)</h3>
          <div id="cargadasList"></div>
        </div>
        <div class="list">
          <h3>Plataformas vac√≠as (<span id="vaciasListCount">0</span>)</h3>
          <div id="vaciasList"></div>
        </div>
        <div class="list">
          <h3>üõ† Plataformas averiadas (<span id="averiadasListCount">0</span>)</h3>
          <div id="averiadasList"></div>
        </div>
      </div>
    </section>

    <!-- Actions -->
    <section class="panel actions">
      <button class="btn btn-primary" id="genPdf">üìÑ Generar PDF</button>
      <button class="btn btn-danger" id="clearAll">üóë Limpiar registros</button>
    </section>
  </div>

<script>
  // ===== Utilities & State =====
  const $ = (id)=>document.getElementById(id);
  const fmtDateLong = (d=new Date()) => d.toLocaleDateString('es-ES', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
  const fmtHour = () => new Date().toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit',second:'2-digit'});

  let plataformas = [];
  let currentMatricula = '';
  let currentEstado = '';

  const STORAGE_KEY = 'plataformas-global';
  function loadData(){ try{ const raw=localStorage.getItem(STORAGE_KEY); plataformas=raw?JSON.parse(raw):[] }catch(e){ plataformas=[] } }
  function saveData(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(plataformas)); }catch(e){} }

  // ===== Single Card Flow logic =====
  const screens = ['s1','s2','s3'];
  let step = 1;
  function showStep(next, dir='forward'){
    const cur = $('s'+step);
    const nxt = $('s'+next);
    if(!nxt || cur===nxt) return;
    cur.classList.remove('active');
    cur.classList.add(dir==='forward' ? 'out-left':'out-right');
    setTimeout(()=>{ cur.classList.remove('out-left','out-right') }, 360);

    nxt.classList.add('active');
    $('d1').classList.toggle('active', next===1);
    $('d2').classList.toggle('active', next===2);
    $('d3').classList.toggle('active', next===3);

    $('flowTitle').textContent = next===1 ? 'Matr√≠cula' : next===2 ? 'Estado' : 'Contenido';
    step = next;
  }

  function nextFromS1(){
    const m = $('matriculaInput').value.trim().toUpperCase();
    if(!m){ alert('Por favor, introduce una matr√≠cula v√°lida'); return; }
    currentMatricula = m;
    $('matriculaDisplay').textContent = m;
    $('matriculaDisplay2').textContent = m;
    showStep(2,'forward');
  }

  function chooseEstado(estado){
    currentEstado = estado;
    $('estadoDisplay').textContent = estado;
    if(estado==='VAC√çA'){
      if(!currentMatricula){ alert('Introduce primero una matr√≠cula v√°lida'); showStep(1,'back'); return; }
      const dup = plataformas.some(p => p.matricula===currentMatricula && p.estado==='VAC√çA');
      if(dup){ alert('‚ö†Ô∏è Esta matr√≠cula ya fue registrada como VAC√çA.'); resetFlow(); return; }
      plataformas.push({ id:Date.now(), matricula:currentMatricula, estado, contenido:'', timestamp:fmtHour() });
      saveData(); updateAll(); resetFlow();
    }else{
      showStep(3,'forward');
    }
  }

  function registrar(){
    const contenido = $('contenidoInput').value.trim();
    if(!contenido){ alert('Describe el contenido o el problema'); return; }
    plataformas.push({ id:Date.now(), matricula:currentMatricula, estado:currentEstado, contenido, timestamp:fmtHour() });
    saveData(); updateAll();
    const btn=$('btnRegistrar'); const prev=btn.textContent;
    btn.disabled=true; btn.textContent='Registrando‚Ä¶';
    setTimeout(()=>{ btn.textContent='Registrado ‚úì';
      setTimeout(()=>{ btn.disabled=false; btn.textContent=prev; resetFlow(); }, 800);
    }, 420);
  }

  function resetFlow(){
    $('matriculaInput').value=''; $('contenidoInput').value='';
    currentMatricula=''; currentEstado=''; showStep(1,'back');
  }

  // ===== UI update =====
  function updateAll(){
    const cargadas = plataformas.filter(p=>p.estado==='CARGADA');
    const vacias   = plataformas.filter(p=>p.estado==='VAC√çA');
    const averiadas= plataformas.filter(p=>p.estado==='AVERIADA');
    $('cargadasCount').textContent=cargadas.length;
    $('vaciasCount').textContent=vacias.length;
    $('averiadasCount').textContent=averiadas.length;
    $('totalCount').textContent=plataformas.length;
    $('cargadasListCount').textContent=cargadas.length;
    $('vaciasListCount').textContent=vacias.length;
    $('averiadasListCount').textContent=averiadas.length;
    renderList('cargadasList', cargadas, true);
    renderList('vaciasList',   vacias,   false);
    renderList('averiadasList',averiadas,true);
  }
  function renderList(id, arr, showContent){
    const box=$(id);
    if(!arr.length){ box.innerHTML='<div class="empty">No hay registros</div>'; return; }
    box.innerHTML = arr.map(it=>(
      '<div class="card-row">'+
        '<div class="head"><span>'+esc(it.matricula)+'</span><span>'+esc(it.timestamp)+'</span></div>'+
        (showContent&&it.contenido?'<div class="body">'+esc(it.contenido)+'</div>':'')+
      '</div>'
    )).join('');
  }
  const esc = (s)=>String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));

  // ===== Exact PDF export (same code as your original) =====
  function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'mm', format: 'a4' });
      const today = new Date();
      const dateString = today.toLocaleDateString('es-ES', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
      }).toUpperCase();

      const cargadas = plataformas.filter(p => p.estado === 'CARGADA');
      const vacias = plataformas.filter(p => p.estado === 'VAC√çA');
      const averiadas = plataformas.filter(p => p.estado === 'AVERIADA');

      // ==== HEADER PRONUNCIADO ====
      doc.setFillColor(255,255,255);
      doc.roundedRect(10, 8, 190, 36, 5, 5, 'F');
      doc.setDrawColor(220,220,220);
      doc.roundedRect(10, 8, 190, 36, 5, 5);
      // sombra ligera (simulada con l√≠nea inferior m√°s oscura)
      doc.setDrawColor(200,200,200);
      doc.line(10, 44, 200, 44);

      // CODE (arriba derecha)
      doc.setFont('helvetica','bold');
      doc.setFontSize(11);
      doc.setTextColor(40,40,40);
      doc.text('CODE', 195, 14, { align: 'right' });

      // Logo XPO LOGISTICS
      doc.setFont('helvetica','bold');
      doc.setFontSize(18);
      const full = 'XPO LOGISTICS';
      const xpoPart = 'XPO ';
      const startX = 105 - (doc.getTextWidth(full) / 2);
      doc.setTextColor(239,68,68);
      doc.text(xpoPart, startX, 22);
      const nextX = startX + doc.getTextWidth(xpoPart);
      doc.setTextColor(0,0,0);
      doc.text('LOGISTICS', nextX, 22);

      // Fecha ligera
      doc.setFont('helvetica','normal');
      doc.setFontSize(8);
      doc.setTextColor(120,120,130);
      doc.text(dateString, 105, 28, { align: 'center' });

      // ==== CARDS (reemplazo de badges) ====
  function drawCard(x, y, w, h, title, value, bgColor, textColor) {
      // fondo con borde ligero
      doc.setFillColor(...bgColor);
      doc.roundedRect(x, y, w, h, 3, 3, 'F');
      doc.setDrawColor(210,210,210);
      doc.roundedRect(x, y, w, h, 3, 3);
      // t√≠tulo (peque√±o)
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(8);
      doc.setTextColor(80,80,90);
      doc.text(title, x + w/2, y + 5, { align: 'center' });
      // valor grande
      doc.setFontSize(12);
      doc.setTextColor(...textColor);
      doc.text(String(value), x + w/2, y + h - 5, { align: 'center' });
  }

  // ==== BADGES ====
      const badgeY = 32;
      const badgeWidth = 40;
      const badgeHeight = 8;
      const gap = 8;
      const totalWidth = badgeWidth*3 + gap*2;
      let bx = 105 - totalWidth/2;

      function drawCard(x,y,w,h,bg,num,label,numColor){
          doc.setFillColor(...bg);
          doc.roundedRect(x,y,w,h,2,2,'F');
          doc.setFont('helvetica','bold');
          doc.setFontSize(8);
          doc.setTextColor(...numColor);
          doc.text(String(num), x+w*0.3, y+h/2+2, { align: 'center' });
          doc.setFont('helvetica','bold');
          doc.setFontSize(7);
          doc.setTextColor(60,60,70);
          doc.text(label, x+w*0.7, y+h/2+2, { align: 'center' });
      }

      drawCard(bx,badgeY,badgeWidth,badgeHeight,[254,226,226],cargadas.length,'CARGADAS',[180,30,50]);
      bx+=badgeWidth+gap;
      drawCard(bx,badgeY,badgeWidth,badgeHeight,[237,249,237],vacias.length,'VAC√çAS',[16,185,129]);
      bx+=badgeWidth+gap;
      drawCard(bx,badgeY,badgeWidth,badgeHeight,[255,245,230],averiadas.length,'AVERIADAS',[200,110,20]);

      let yPosition = 52; // m√°s abajo para no invadir header

      // ==== TABLAS ====
      const bottomMargin = 260;

      function createTwoColumnTables(leftTitle,leftData,rightTitle,rightData,startY){
          let currentY=startY;
          const leftX=15;
          const rightX=110;
          const columnWidth=85;

          // T√≠tulo de tabla fuerte
          doc.setFont('helvetica','bold');
          doc.setFontSize(12);
          if(leftData.length>0) doc.text(leftTitle.toUpperCase(),leftX,currentY);
          if(rightData.length>0) doc.text(rightTitle.toUpperCase(),rightX,currentY);
          currentY+=8;

          if(leftData.length>0){
              doc.setFillColor(245,247,250);
              doc.rect(leftX,currentY-4,columnWidth,7,'F');
              doc.setFont('helvetica','bold');
              doc.setFontSize(9);
              doc.text('MATRICULA',leftX+2,currentY);
              doc.text('CONTENIDO',leftX+35,currentY);
          }
          if(rightData.length>0){
              doc.setFillColor(245,247,250);
              doc.rect(rightX,currentY-4,columnWidth,7,'F');
              doc.setFont('helvetica','bold');
              doc.setFontSize(9);
              doc.text('MATRICULA',rightX+2,currentY);
          }
          currentY+=8;

          doc.setFont('helvetica','normal');
          doc.setFontSize(8);

          const maxRows=Math.max(leftData.length,rightData.length);
          for(let i=0;i<maxRows;i++){
              if(i%2===0){
                  if(leftData[i]){doc.setFillColor(252,253,255);doc.rect(leftX,currentY-3,columnWidth,6,'F');}
                  if(rightData[i]){doc.setFillColor(252,253,255);doc.rect(rightX,currentY-3,columnWidth,6,'F');}
              }
              if(leftData[i]){
                  doc.text(leftData[i].matricula.toUpperCase(),leftX+2,currentY);
                  if(leftData[i].contenido){
                      const lines=doc.splitTextToSize(leftData[i].contenido.toUpperCase(),45);
                      doc.text(lines,leftX+35,currentY);
                      if(lines.length>1) currentY+=(lines.length-1)*3;
                  }
              }
              if(rightData[i]){
                  doc.text(rightData[i].matricula.toUpperCase(),rightX+2,currentY);
              }
              currentY+=6;

              if(currentY>bottomMargin){
                  doc.addPage();
                  currentY=30;
              }
          }
          return currentY+10;
      }

      function createSingleTable(title,data,startY){
          let currentY=startY;
          if(data.length===0) return currentY;

          doc.setFont('helvetica','bold');
          doc.setFontSize(12);
          doc.text(title.toUpperCase(),15,currentY);
          currentY+=8;

          doc.setFillColor(245,247,250);
          doc.rect(15,currentY-4,180,7,'F');
          doc.setFont('helvetica','bold');
          doc.setFontSize(9);
          doc.text('MATRICULA',17,currentY);
          doc.text('DESCRIPCION',70,currentY);
          currentY+=8;

          doc.setFont('helvetica','normal');
          doc.setFontSize(8);
          data.forEach((platform,index)=>{
              if(index%2===0){doc.setFillColor(252,253,255);doc.rect(15,currentY-3,180,6,'F');}
              doc.text(platform.matricula.toUpperCase(),17,currentY);
              if(platform.contenido){
                  const lines=doc.splitTextToSize(platform.contenido.toUpperCase(),120);
                  doc.text(lines,70,currentY);
                  if(lines.length>1) currentY+=(lines.length-1)*3;
              }
              currentY+=6;
              if(currentY>bottomMargin){
                  doc.addPage();
                  currentY=30;
              }
          });
          return currentY+10;
      }

      if(cargadas.length>0||vacias.length>0){
          yPosition=createTwoColumnTables(
              'PLATAFORMAS CARGADAS '+cargadas.length,
              cargadas,
              'PLATAFORMAS VAC√çAS '+vacias.length,
              vacias,
              yPosition
          );
      }
      if(averiadas.length>0){
          yPosition=createSingleTable('PLATAFORMAS AVERIADAS ('+averiadas.length+')',averiadas,yPosition);
      }

      // ==== FOOTER ====
      const pageCount=doc.internal.getNumberOfPages();
      for(let i=1;i<=pageCount;i++){
          doc.setPage(i);
          doc.setFont('helvetica','normal');
          doc.setFontSize(8);
          doc.setTextColor(100,100,110);
          doc.text('¬© 2025 XPO LOGISTICS ‚Äì Informe interno',20,285);
          doc.setTextColor(60,90,180);
          doc.textWithLink('https://vbenyx.github.io/XPO-LOGISTICS/', 105, 285, { url: 'https://vbenyx.github.io/XPO-LOGISTICS/', align: 'center' });
          doc.setTextColor(100,100,110);
          doc.text('P√°gina '+i+' de '+pageCount,190,285,{align:'right'});
      }

      
      const exportDateForName = new Date().toLocaleDateString('es-ES', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
      }).replace(/\//g, '-');
      doc.save(`reporte_plataformas_${exportDateForName}.pdf`);
      
  }

  // ===== Init =====
  window.addEventListener('DOMContentLoaded', () => {
    $('currentDate').textContent = fmtDateLong().toUpperCase();
    loadData(); updateAll();

    $('toS2').addEventListener('click', nextFromS1);
    $('back1').addEventListener('click', ()=>showStep(1,'back'));
    $('back2').addEventListener('click', ()=>showStep(2,'back'));
    $('btnCargada').addEventListener('click', ()=>chooseEstado('CARGADA'));
    $('btnVacia').addEventListener('click',   ()=>chooseEstado('VAC√çA'));
    $('btnAveriada').addEventListener('click',()=>chooseEstado('AVERIADA'));
    $('btnRegistrar').addEventListener('click', registrar);

    $('genPdf').addEventListener('click', generatePDF);
    $('clearAll').addEventListener('click', ()=>{
      if(!plataformas.length){ alert('No hay registros para limpiar'); return; }
      if(confirm('¬øSeguro que quieres eliminar todos los registros?')){
        plataformas=[]; saveData(); updateAll(); resetFlow();
      }
    });

    document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='hidden') saveData(); });
    window.addEventListener('beforeunload', saveData);
  });
</script>
</body>
</html>
